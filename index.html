<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkez Cumhuriyet ƒ∞lkokulu Turnuva Sistemi</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #00f2ea; --secondary: #ff0050; --bg-dark: #0b0c15; --card-bg: #151922; --border: #2a2a35; --success: #00ff88; --warning: #ffd700; --text-main: #e0e6ed; }
        html, body { overflow-x: hidden; scrollbar-width: none; -ms-overflow-style: none; }
        ::-webkit-scrollbar { display: none; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); min-height: 100vh; padding-bottom: 50px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 30px; padding-top: 30px; }
        h1 { font-family: 'Exo 2'; font-size: 2.5rem; font-weight: 800; background: linear-gradient(to right, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        #loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; display:flex; justify-content:center; align-items:center; flex-direction:column; }
        .spinner { width: 50px; height: 50px; border: 5px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .view-section { display: none; animation: fadeIn 0.5s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
        .form-card { background: var(--card-bg); border: 1px solid var(--border); padding: 30px; border-radius: 16px; max-width: 500px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .form-group { margin-bottom: 20px; text-align: left; position: relative; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #aaa; }
        input, select { width: 100%; padding: 12px; background: #0b0c15; border: 1px solid var(--border); color: #fff; border-radius: 8px; font-size: 1rem; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }
        .submit-btn { width: 100%; padding: 15px; background: var(--primary); color: #000; font-weight: 800; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: 0.3s; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 242, 234, 0.3); }
        
        /* ARAMA SONU√áLARI Lƒ∞STESƒ∞ */
        .search-results {
            position: absolute; top: 100%; left: 0; width: 100%;
            background: #1a1d26; border: 1px solid var(--primary);
            border-radius: 8px; max-height: 250px; overflow-y: auto;
            z-index: 1000; display: none;
        }
        .search-item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #333; transition: 0.2s; }
        .search-item:hover { background: rgba(0, 242, 234, 0.1); color: #fff; }
        .search-item strong { color: var(--primary); display: block; font-size: 1.1rem; }
        .search-item span { font-size: 0.9rem; color: #aaa; }

        /* SE√áƒ∞LEN √ñƒûRENCƒ∞ KARTI */
        .selected-student-card {
            background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success);
            padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;
            display: flex; justify-content: space-between; align-items: center;
        }
        .selected-info strong { display: block; color: #fff; font-size: 1.2rem; }
        .selected-info span { color: var(--success); font-weight: bold; font-size: 1.1rem; }
        .btn-remove-sel { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 1.5rem; padding: 0 10px; }

        .admin-panel { background: rgba(255, 255, 255, 0.02); border: 1px solid var(--border); padding: 20px; border-radius: 12px; margin-bottom: 30px; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #000; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #333; }
        .stat-num { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .player-list { max-height: 400px; overflow-y: auto; background: #000; border-radius: 8px; border: 1px solid var(--border); }
        .player-item { display: flex; justify-content: space-between; padding: 10px 15px; border-bottom: 1px solid #222; align-items: center; }
        .del-btn { background: var(--secondary); color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .action-bar { display: flex; gap: 10px; margin-top: 20px; }
        .action-btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-start { background: var(--success); color: #000; }
        .btn-close { background: var(--warning); color: #000; }
        .btn-reset { background: var(--danger); color: #fff; }
        .bracket-container { display: flex; flex-direction: column; gap: 30px; }
        .round-block { background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .round-title { text-align: center; color: var(--warning); font-size: 1.5rem; font-weight: 800; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .matches-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .match-card { background: #16181e; border: 1px solid var(--border); border-radius: 8px; padding: 10px; position: relative; }
        .match-card.completed { border-color: var(--success); }
        .status-badge { position: absolute; top: -8px; right: 10px; font-size: 0.7rem; background: var(--success); color: #000; padding: 2px 8px; border-radius: 8px; font-weight: 800; display: none; }
        .match-card.completed .status-badge { display: block; }
        .player-row { display: flex; justify-content: space-between; padding: 8px 10px; background: rgba(255,255,255,0.03); margin-bottom: 5px; border-radius: 4px; align-items: center; }
        .player-row.winner { background: rgba(0, 255, 136, 0.15); border-left: 4px solid var(--success); }
        .p-name { font-weight: 700; color: #fff; font-size: 0.95rem; }
        .p-class { font-size: 0.8rem; color: #ff9f43; margin-left: auto; padding-left: 10px; }
        .score-val { font-weight: 800; font-size: 1.2rem; width: 30px; text-align: center; }
        .btn-s { width: 24px; height: 24px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; margin: 0 2px; }
        .btn-plus { background: var(--primary); }
        .btn-minus { background: #333; color: #fff; }
        .game-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 25px; background: transparent; border: 1px solid var(--border); color: #888; border-radius: 50px; cursor: pointer; }
        .tab-btn.active { border-color: var(--primary); color: #fff; background: rgba(0, 242, 234, 0.1); }
        .admin-login-btn { position: fixed; bottom: 10px; right: 10px; opacity: 0.3; cursor: pointer; background: none; border: none; color: #fff; font-size: 1.5rem; }
        
        .announcement-box { background: linear-gradient(90deg, rgba(255, 0, 80, 0.15) 0%, rgba(255, 0, 80, 0.05) 100%); border: 2px solid var(--secondary); border-radius: 12px; padding: 15px; margin: 20px auto; max-width: 800px; text-align:center; }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <div style="color:#fff; font-weight:600">Veriler Y√ºkleniyor...</div>
</div>

<div class="container">
    <header>
        <h1>MERKEZ CUMHURƒ∞YET ƒ∞LKOKULU</h1>
        <h3 style="color:#888; letter-spacing:2px;">TURNUVA Y√ñNETƒ∞M Sƒ∞STEMƒ∞</h3>
    </header>

    <!-- 1. KAYIT EKRANI (Ziyaret√ßi - Akƒ±llƒ± Arama) -->
    <div id="registration-view" class="view-section">
        <div class="announcement-box">
            <h2 style="color:var(--primary); margin-bottom:10px;">TURNUVA KAYIT</h2>
            <p>L√ºtfen isminizi aratarak se√ßiniz.</p>
        </div>
        <div class="form-card">
            <div class="form-group">
                <label>Oyun Se√ßiniz</label>
                <select id="reg-game">
                    <option value="2">Abluka</option>
                    <option value="4">Equilibrio</option>
                </select>
            </div>
            
            <!-- Se√ßilen √ñƒürenci G√∂r√ºn√ºm√º -->
            <div id="selected-student-display" class="selected-student-card" style="display:none;">
                <div class="selected-info">
                    <strong id="disp-name"></strong>
                    <span id="disp-class"></span>
                </div>
                <button class="btn-remove-sel" onclick="clearSelection()"><i class="fas fa-times"></i></button>
            </div>

            <!-- Arama Kutusu -->
            <div class="form-group" id="search-container">
                <label>√ñƒürenci Adƒ± Ara</label>
                <input type="text" id="student-search" placeholder="ƒ∞sim yazmaya ba≈ülayƒ±n..." autocomplete="off">
                <div id="search-results" class="search-results"></div>
            </div>

            <button class="submit-btn" onclick="registerStudent()">KAYIT OL</button>
        </div>
    </div>

    <!-- 2. BEKLEME EKRANI -->
    <div id="waiting-view" class="view-section">
        <div class="form-card" style="text-align:center;">
            <i class="fas fa-clock" style="font-size:3rem; color:var(--warning); margin-bottom:20px;"></i>
            <h2>Kayƒ±tlar Kapandƒ±</h2>
            <p style="color:#aaa; margin-top:10px;">Turnuva e≈üle≈ümeleri hazƒ±rlanƒ±yor.</p>
        </div>
    </div>

    <!-- 3. TURNUVA ƒ∞ZLEME -->
    <div id="tournament-view" class="view-section">
        <div class="game-tabs" id="game-tabs"></div>
        <div id="bracket-area" class="bracket-container"></div>
    </div>

    <!-- 4. ADMIN PANELƒ∞ -->
    <div id="admin-view" class="view-section">
        <div class="admin-panel">
            <h2 style="margin-bottom:20px; color:var(--primary)">Y√ñNETƒ∞Cƒ∞ PANELƒ∞</h2>
            <div class="stat-grid">
                <div class="stat-card"><div>Abluka Kayƒ±t</div><div class="stat-num" id="count-abluka">0</div></div>
                <div class="stat-card"><div>Equilibrio Kayƒ±t</div><div class="stat-num" id="count-equilibrio">0</div></div>
                <div class="stat-card"><div>Durum</div><div class="stat-num" id="status-text" style="font-size:1.2rem; line-height:2.5rem">-</div></div>
            </div>
            
            <div class="player-list" id="admin-player-list"></div>

            <div class="action-bar">
                <button class="action-btn btn-close" onclick="changeStatus('closed')">KAYITLARI KAPAT</button>
                <button class="action-btn btn-start" onclick="startTournament()">TURNUVAYI BA≈ûLAT</button>
                <button class="action-btn btn-reset" onclick="resetSystem()">SIFIRLA</button>
            </div>
            
            <div style="margin-top:20px; text-align:center;">
                <button class="tab-btn" onclick="showTournamentViewAdmin()">TURNUVA EKRANINA Gƒ∞T</button>
            </div>
        </div>
    </div>
</div>

<button class="admin-login-btn" onclick="adminLogin()"><i class="fas fa-lock"></i></button>

<script>
    // --- T√úM √ñƒûRENCƒ∞ Lƒ∞STESƒ∞ ---
    const ALL_STUDENTS = [
{name:"R√úYA KULAK", class:"1/A"}, {name:"ALƒ∞N ADA G√ñRD√ú", class:"1/A"}, {name:"H√úSEYƒ∞N PAMƒ∞R G√úL", class:"1/A"}, {name:"ESƒ∞LA YILMAZ", class:"1/A"}, {name:"YEKTA Mƒ∞LAT YILDIZ", class:"1/A"}, {name:"MUSACAN KAHRAMAN", class:"1/A"}, {name:"ELƒ∞F ABDULLATƒ∞F", class:"1/A"}, {name:"AHMET GEN√á AKBA≈û", class:"1/A"}, {name:"AHMET SELƒ∞M KUL", class:"1/A"}, {name:"MAYA ORHAN", class:"1/A"}, {name:"DENƒ∞Z SALDIRI≈û", class:"1/A"}, {name:"FADƒ∞MENUR KIRDAGEZER", class:"1/A"}, {name:"EMƒ∞R ALƒ∞ TOZOƒûLU", class:"1/A"}, {name:"TOPRAK AKDEMƒ∞R", class:"1/A"}, {name:"NEHƒ∞R DEMƒ∞RBA≈û", class:"1/A"}, {name:"S√úMEYYENUR KIR√áOVA", class:"1/A"}, {name:"DERƒ∞N TOYRAN", class:"1/A"}, {name:"YUSUF ARSLAN", class:"1/A"}, {name:"ƒ∞KRANUR KILI√á", class:"1/A"}, {name:"BERAT KAYA", class:"1/A"}, {name:"MUHAMMED EYMEN KONDAL", class:"1/A"}, {name:"SUDE BAYRAM", class:"1/A"}, {name:"HALƒ∞L ATA SEVƒ∞N√á", class:"1/A"}, {name:"AYCAN TA≈ûD√ñVEN", class:"1/A"}, {name:"MERYEM AƒûIRBA≈û", class:"1/A"}, {name:"Hƒ∞RANUR UZUN", class:"1/A"}, {name:"NUR ELHUDE AHMED", class:"1/A"}, {name:"ALƒ∞ YILMAZ ESEN", class:"1/A"}, {name:"ESLEM SONDUK", class:"1/A"}, {name:"AHMED ATLI", class:"1/A"}, {name:"ZEYNEP ECRƒ∞N √ñZCAN", class:"1/A"}, {name:"Yƒ∞ƒûƒ∞T TOSUNOƒûLU", class:"1/A"}, {name:"ATA Yƒ∞ƒûƒ∞T BAYSAL", class:"1/A"},
{name:"DENƒ∞Z KASAR", class:"1/B"}, {name:"BUƒûLEM YILMAZOƒûLU", class:"1/B"}, {name:"ELƒ∞F ƒ∞≈ûG√úDEN", class:"1/B"}, {name:"MELEK √ñZER", class:"1/B"}, {name:"BEREN ƒ∞STANBULLU", class:"1/B"}, {name:"S√úHEYLE ABDULLATƒ∞F", class:"1/B"}, {name:"ALPARSLAN YE≈ûƒ∞LYURT", class:"1/B"}, {name:"ECRƒ∞N BOZKURT", class:"1/B"}, {name:"MESUT ASLANATA", class:"1/B"}, {name:"BULUT DEMƒ∞RBA≈û", class:"1/B"}, {name:"DEVRAN BEYAZER", class:"1/B"}, {name:"K√úBRA G√úRSES", class:"1/B"}, {name:"ALƒ∞ ƒ∞HSAN KALELƒ∞", class:"1/B"}, {name:"FATƒ∞H MEHMET ERƒ∞N", class:"1/B"}, {name:"HASRET ERDEM", class:"1/B"}, {name:"EY√úP ASAF BEKTA≈û", class:"1/B"}, {name:"DERƒ∞N KOYUN", class:"1/B"}, {name:"ELƒ∞F NAZ KARAKA≈û", class:"1/B"}, {name:"Mƒ∞RA√á √áELƒ∞K", class:"1/B"}, {name:"HAZAL √ñZT√úRK", class:"1/B"}, {name:"EYMEN KAYA", class:"1/B"}, {name:"AZMƒ∞ ≈ûEN", class:"1/B"}, {name:"ARDA CAN", class:"1/B"}, {name:"HAVVA Yƒ∞ƒûƒ∞T", class:"1/B"}, {name:"AHMET BUƒûRA DEMƒ∞R", class:"1/B"}, {name:"ASEL DEMƒ∞RBƒ∞LEK", class:"1/B"}, {name:"BERRA AVCƒ∞", class:"1/B"}, {name:"ESƒ∞LA EROƒûLU", class:"1/B"}, {name:"ƒ∞KRA DEMƒ∞RTA≈û", class:"1/B"}, {name:"MERT GUN√áE", class:"1/B"}, {name:"ALPEREN AƒûIRMAN", class:"1/B"}, {name:"YUSUF ƒ∞BRAHƒ∞M", class:"1/B"}, {name:"R√úZGAR Bƒ∞Lƒ∞R", class:"1/B"}, {name:"DUYGU NEFES G√úNG√ñR", class:"1/B"},
{name:"ILGIN EROL", class:"1/C"}, {name:"AZRA KENƒ∞R", class:"1/C"}, {name:"MEHMET ARAS ≈ûAHƒ∞N", class:"1/C"}, {name:"TOPRAK EFE Y√úR√úK", class:"1/C"}, {name:"ADNAN AYAZ KUMCU", class:"1/C"}, {name:"YUSUF BEDEVƒ∞", class:"1/C"}, {name:"Hƒ∞RANUR AKPINAR", class:"1/C"}, {name:"G√ñK√áE D√úZMEN", class:"1/C"}, {name:"SAMƒ∞ ANIK", class:"1/C"}, {name:"UMAY √ñZDEMƒ∞R", class:"1/C"}, {name:"DORUK √áƒ∞Nƒ∞", class:"1/C"}, {name:"HAYRƒ∞YE GEN√á", class:"1/C"}, {name:"ENVER EMƒ∞R DOYMAZ", class:"1/C"}, {name:"FEYZA Y√úSRA KILBA≈û", class:"1/C"}, {name:"Yƒ∞ƒûƒ∞T TOPCU", class:"1/C"}, {name:"ABDURRAHMAN HAZZANƒ∞", class:"1/C"}, {name:"NAME √ñZI≈ûIK", class:"1/C"}, {name:"ZEYNEP KEKLƒ∞K", class:"1/C"}, {name:"EGEMEN G√ñRMEK", class:"1/C"}, {name:"POLAT DEMƒ∞RBA≈û", class:"1/C"}, {name:"ECE TOROS", class:"1/C"}, {name:"Z√úMRA KARA", class:"1/C"}, {name:"YAƒûMUR BALTA", class:"1/C"}, {name:"BESTE SARICA", class:"1/C"}, {name:"G√ñRKEM KARAPINAR", class:"1/C"}, {name:"Nƒ∞DAL HALLAK", class:"1/C"}, {name:"HAZAL ≈ûAHƒ∞N", class:"1/C"}, {name:"AREL ERDEM AYKURT", class:"1/C"}, {name:"MEYS EL DERVƒ∞≈û", class:"1/C"}, {name:"FATMA DERƒ∞N ƒ∞STANBULLIOƒûLU", class:"1/C"}, {name:"BERDAN ERKMEN", class:"1/C"}, {name:"AMMAR HAMO", class:"1/C"}, {name:"ELƒ∞F RAVZA AYDIN", class:"1/C"}, {name:"MUHAMMED YAƒûIZ KAYA", class:"1/C"}, {name:"ƒ∞SA KARAAƒûA√á", class:"1/C"}, {name:"BUƒûLEM NURƒ∞YE VEZƒ∞", class:"1/C"},
{name:"EFSA NUR √áƒ∞FTCƒ∞", class:"1/D"}, {name:"YAƒûMUR Lƒ∞NA AKALAN", class:"1/D"}, {name:"ALƒ∞ TUƒûRA DEMƒ∞R", class:"1/D"}, {name:"DURU GEN√á", class:"1/D"}, {name:"HATƒ∞CE Hƒ∞RA ƒ∞LKAY", class:"1/D"}, {name:"EGE √áƒ∞NAR", class:"1/D"}, {name:"HAMZA DORUK DEMƒ∞R", class:"1/D"}, {name:"BADE HANSU", class:"1/D"}, {name:"BERƒ∞VAN NEHƒ∞R KOTAN", class:"1/D"}, {name:"√ñYK√ú √ñLMEZ", class:"1/D"}, {name:"Mƒ∞RAY DURU BALOƒûLU", class:"1/D"}, {name:"EBRU √ñNAL", class:"1/D"}, {name:"EMƒ∞R FATƒ∞H √ñRS", class:"1/D"}, {name:"EMƒ∞R ASAF KIZILTA≈û", class:"1/D"}, {name:"ƒ∞LKER YAƒûIZ", class:"1/D"}, {name:"Yƒ∞ƒûƒ∞T KAYRA √ñNC√ú", class:"1/D"}, {name:"CANAN NERGƒ∞Z", class:"1/D"}, {name:"Mƒ∞LA KASAP", class:"1/D"}, {name:"DERƒ∞N TA≈ûDEMƒ∞R", class:"1/D"}, {name:"Hƒ∞RANUR K√ñSE", class:"1/D"}, {name:"ENGƒ∞N CAN G√ñLC√ú", class:"1/D"}, {name:"FURKAN AƒûY√úREK", class:"1/D"}, {name:"EYMEN KAYAOƒûLU", class:"1/D"}, {name:"ELƒ∞F ADA SEVƒ∞K", class:"1/D"}, {name:"ƒ∞RFAN ADƒ∞L DEMƒ∞REL", class:"1/D"}, {name:"DORUK EDƒ∞S", class:"1/D"}, {name:"√ñMER ASAF √ñNC√ú", class:"1/D"}, {name:"OSMAN Yƒ∞ƒûƒ∞T", class:"1/D"}, {name:"KAMURAN AYAZ KANTARCI", class:"1/D"}, {name:"REHEF EL ALƒ∞", class:"1/D"}, {name:"AMMAR ≈ûEBBEK", class:"1/D"}, {name:"MEDƒ∞NE DURU KARA", class:"1/D"}, {name:"MEHMET EMƒ∞R BAH√áE", class:"1/D"},
{name:"BARAA ƒ∞BRAHƒ∞M", class:"1/E"}, {name:"DAMLA U√áAR", class:"1/E"}, {name:"Bƒ∞LAL GEDƒ∞KLƒ∞", class:"1/E"}, {name:"MELEK TA≈û", class:"1/E"}, {name:"ABDULKAFƒ∞ EL √ñMER", class:"1/E"}, {name:"Yƒ∞ƒûƒ∞T HAMZA CENGƒ∞Z", class:"1/E"}, {name:"UMUT ƒ∞SA KILI√á", class:"1/E"}, {name:"YAƒûIZ ƒ∞SMET KILI√á", class:"1/E"}, {name:"ATE≈û U√áUK", class:"1/E"}, {name:"Hƒ∞RA √áELƒ∞K", class:"1/E"}, {name:"MUHAMMED ENES TUNCER", class:"1/E"}, {name:"SALƒ∞H ERDEM YAZAR", class:"1/E"}, {name:"KERƒ∞M SALƒ∞H AKMAN", class:"1/E"}, {name:"√ñMER ASAF ERHAN", class:"1/E"}, {name:"MELƒ∞N PEKƒ∞N", class:"1/E"}, {name:"MUHAMMED EMƒ∞R KO√áAK", class:"1/E"}, {name:"MEHMET ALƒ∞ KOTAN", class:"1/E"}, {name:"KAAN ALƒûAN", class:"1/E"}, {name:"BADE Yƒ∞ƒûƒ∞T", class:"1/E"}, {name:"Z√úLEYHA ≈ûAHƒ∞N", class:"1/E"}, {name:"AHMETHAN SARIASLAN", class:"1/E"}, {name:"ƒ∞KRANUR KORKMAZ", class:"1/E"}, {name:"BEYZA EMET", class:"1/E"}, {name:"MELƒ∞KE ƒ∞LHAN", class:"1/E"}, {name:"SIRA√á DURAN", class:"1/E"}, {name:"Dƒ∞LARA √áETƒ∞N", class:"1/E"}, {name:"MEHMET KAƒûAN KA√áAR", class:"1/E"}, {name:"ELƒ∞F YAREN KARTAL", class:"1/E"}, {name:"DEFNE ELƒ∞F I≈ûIK", class:"1/E"}, {name:"HAYRUNNƒ∞SA √áE√áEN", class:"1/E"}, {name:"DERƒ∞N AKBULUT", class:"1/E"}, {name:"ELƒ∞F NAZ Bƒ∞LEN", class:"1/E"}, {name:"YUSUF AYAZ G√ñRMEK", class:"1/E"}, {name:"YASEMƒ∞N KILBA≈û", class:"1/E"}, {name:"YUSUF CEYLAN", class:"1/E"},
{name:"Z√úLAL S√ñZBƒ∞Lƒ∞R", class:"2/A"}, {name:"ƒ∞KRANUR AYDENƒ∞Z", class:"2/A"}, {name:"AYAZ YANAR", class:"2/A"}, {name:"AFRA NAS YILDIZ", class:"2/A"}, {name:"AHMET ASAF KOCA", class:"2/A"}, {name:"EBRAR Dƒ∞LEK KASAPLAR", class:"2/A"}, {name:"ƒ∞NCƒ∞ K√ñSE", class:"2/A"}, {name:"ESƒ∞LA √ñZ", class:"2/A"}, {name:"HAFƒ∞ZE YE≈ûƒ∞LYURT", class:"2/A"}, {name:"AHSEN DEMƒ∞RBA≈û", class:"2/A"}, {name:"Mƒ∞R METE YANAR", class:"2/A"}, {name:"REYYAN AKA", class:"2/A"}, {name:"Yƒ∞ƒûƒ∞T ARAS G√úL√áƒ∞MEN", class:"2/A"}, {name:"ZEYNEP √áAMUR", class:"2/A"}, {name:"BA≈ûAK EREN", class:"2/A"}, {name:"HALƒ∞T Mƒ∞RA√á ARAS", class:"2/A"}, {name:"HAMZA TURAN √úLBEƒûƒ∞", class:"2/A"}, {name:"EMƒ∞R √ñZT√úRK", class:"2/A"}, {name:"HACER UHEYBƒ∞", class:"2/A"}, {name:"HAFSANUR SERTEL", class:"2/A"}, {name:"ELA G√úLER", class:"2/A"}, {name:"EZGƒ∞ YAZIK", class:"2/A"}, {name:"Nƒ∞DAL AL ELIWI", class:"2/A"}, {name:"ƒ∞NCƒ∞ SU B√úT√úNER", class:"2/A"}, {name:"MUHAMMED ≈ûIHADƒ∞", class:"2/A"},
{name:"BURAK KARA", class:"2/B"}, {name:"H√úSEYƒ∞N EFE ARI", class:"2/B"}, {name:"√áAƒûATAY √ñZER", class:"2/B"}, {name:"ALEYNA SEVCAN", class:"2/B"}, {name:"AZRA TOROS", class:"2/B"}, {name:"ALPEREN √áAVU≈û", class:"2/B"}, {name:"√áAƒûAN MOLLA", class:"2/B"}, {name:"KAAN EMRE AYDIN", class:"2/B"}, {name:"MELƒ∞S KIZIL√áINAR", class:"2/B"}, {name:"EFE PARLAK", class:"2/B"}, {name:"DEFNE √ñZDEMƒ∞R", class:"2/B"}, {name:"RANA ABDULKADER ABLAK", class:"2/B"}, {name:"Sƒ∞MANUR U√áAR", class:"2/B"}, {name:"ZEYNEP KUZEY", class:"2/B"}, {name:"HAYAL YONTAR", class:"2/B"}, {name:"SEFA YILMAZOƒûLU", class:"2/B"}, {name:"KAYRA YAƒûIZ SARGIN", class:"2/B"}, {name:"ECENUR KAHRAMAN", class:"2/B"}, {name:"√áAƒûAN ≈ûEREF ALTUN", class:"2/B"}, {name:"EMRE √áALI≈ûLAR", class:"2/B"}, {name:"AZRA DEFNE HORASAN", class:"2/B"}, {name:"BERƒ∞L DEMƒ∞RTA≈û", class:"2/B"}, {name:"MUHAMMED EMƒ∞N √áORUH", class:"2/B"}, {name:"EDANUR TA≈û", class:"2/B"}, {name:"ARDA BE≈ûPINARLI", class:"2/B"}, {name:"MELƒ∞H KIR≈ûEHƒ∞RLƒ∞", class:"2/B"}, {name:"YUSUF ADSƒ∞Z", class:"2/B"}, {name:"EMƒ∞NE Nƒ∞SA √ñZDEMƒ∞R", class:"2/B"}, {name:"MUHAMMED ENSAR EROƒûLU", class:"2/B"}, {name:"MELEK SU ≈ûEN", class:"2/B"}, {name:"√úMRA SUNA KALELƒ∞", class:"2/B"}, {name:"√ñYK√ú Tƒ∞RYAKƒ∞", class:"2/B"}, {name:"DEFNE SULUOƒûLU", class:"2/B"}, {name:"ELƒ∞F ƒ∞PEK DEMƒ∞REL", class:"2/B"},
{name:"BERAT ACA", class:"2/C"}, {name:"Rƒ∞M ALBEM", class:"2/C"}, {name:"AY≈ûEG√úL KABAR", class:"2/C"}, {name:"NAZLI AKBA≈û", class:"2/C"}, {name:"√ñMER AKG√úN", class:"2/C"}, {name:"ALYA CAN", class:"2/C"}, {name:"ELƒ∞F RANA YAZAR", class:"2/C"}, {name:"FATMA ABDULLATƒ∞F", class:"2/C"}, {name:"√úMM√ú G√úLS√úM AƒûIRBA≈û", class:"2/C"}, {name:"ZEYNEP FEYZA √ñZEN", class:"2/C"}, {name:"TESNƒ∞M AHMAD", class:"2/C"}, {name:"ASƒ∞L ATA G√úL", class:"2/C"}, {name:"EMRAH KASAP", class:"2/C"}, {name:"√ñMER ASAF SEVƒ∞K", class:"2/C"}, {name:"OƒûUZ I≈ûIK", class:"2/C"}, {name:"CANER √ñZT√úRK", class:"2/C"}, {name:"MELƒ∞H ACUN", class:"2/C"}, {name:"SELAM EL ALƒ∞Vƒ∞", class:"2/C"}, {name:"ARAS DEMƒ∞RBA≈û", class:"2/C"}, {name:"YUSUF √áOBAN", class:"2/C"}, {name:"YAƒûIZ TUNA √áETƒ∞NKAYA", class:"2/C"}, {name:"ALMƒ∞RA G√úLFƒ∞DAN EROƒûLU", class:"2/C"}, {name:"GADƒ∞R DABOL", class:"2/C"}, {name:"FURKAN EMƒ∞N UZUN", class:"2/C"}, {name:"BARAN BAH√áE", class:"2/C"}, {name:"Mƒ∞RASU LA√áƒ∞NKAYA", class:"2/C"}, {name:"Mƒ∞RAY ERKEK", class:"2/C"}, {name:"Sƒ∞NEM UYANIK", class:"2/C"}, {name:"EBUBEKƒ∞R KO√áU", class:"2/C"}, {name:"ƒ∞LKER MERT √áETƒ∞N", class:"2/C"}, {name:"SILA NUR T√úNCƒ∞", class:"2/C"}, {name:"MUHAMMED SAƒ∞D ALEZZO", class:"2/C"},
{name:"SU TOPCUOƒûLU", class:"2/D"}, {name:"ONUR KARAKA≈û", class:"2/D"}, {name:"EYMEN ZINBA", class:"2/D"}, {name:"Mƒ∞RA KAMA", class:"2/D"}, {name:"KEMAL EGE ARICI", class:"2/D"}, {name:"Hƒ∞RA TOSUN", class:"2/D"}, {name:"AZRA MELEK √áAVDAR", class:"2/D"}, {name:"ESLEM TUNA", class:"2/D"}, {name:"ƒ∞KRA BALOƒûLU", class:"2/D"}, {name:"M√úRƒ∞VET BELƒ∞NAY YILMAZ", class:"2/D"}, {name:"TUƒûBA Nƒ∞SA ≈ûAHƒ∞N", class:"2/D"}, {name:"ZEYNEP ORHAN", class:"2/D"}, {name:"NERMƒ∞N MUHAMMED", class:"2/D"}, {name:"ALƒ∞ ASLAN", class:"2/D"}, {name:"√áINAR DEMƒ∞RBA≈û", class:"2/D"}, {name:"FURKAN Dƒ∞LEK", class:"2/D"}, {name:"KEMAL OKTAY", class:"2/D"}, {name:"√ñMER BAK", class:"2/D"}, {name:"UBEYDULLAH √ñNAL", class:"2/D"}, {name:"Yƒ∞ƒûƒ∞T ≈ûAHAN", class:"2/D"}, {name:"SERHAT √úNAL", class:"2/D"}, {name:"UMUT √ñZT√úRK", class:"2/D"}, {name:"ASLAN KEMAL S√ñYLEMEZ", class:"2/D"}, {name:"R√úZGAR ERDUR", class:"2/D"}, {name:"SARP G√úND√úZ", class:"2/D"}, {name:"ATABEY AVCI", class:"2/D"}, {name:"H√úMA ATASOY", class:"2/D"}, {name:"DURU AKIN", class:"2/D"}, {name:"MUHAMMED EFE YENƒ∞LMEZ", class:"2/D"}, {name:"EGEMEN CANG√úR", class:"2/D"}, {name:"HUDE ALEZZO", class:"2/D"},
{name:"Hƒ∞RANUR √áE√áEN", class:"2/E"}, {name:"Yƒ∞ƒûƒ∞T HAMZA SU", class:"2/E"}, {name:"Tƒ∞MUR TAHA DEMƒ∞R", class:"2/E"}, {name:"AZRA ALP", class:"2/E"}, {name:"ASYA DURAN", class:"2/E"}, {name:"KUMSAL AKKU≈û", class:"2/E"}, {name:"S√úMEYYE KIRKPINAR", class:"2/E"}, {name:"G√úNE≈û GEN√á", class:"2/E"}, {name:"ZEHRANUR ATA≈û", class:"2/E"}, {name:"G√ñRKEM KARA", class:"2/E"}, {name:"ALƒ∞ G√úRSOY", class:"2/E"}, {name:"ENES G√úZEL", class:"2/E"}, {name:"√ñMER SELƒ∞M DAƒû", class:"2/E"}, {name:"ATAKAN AƒûBULUT", class:"2/E"}, {name:"BARAN EYMEN G√úNC√ú", class:"2/E"}, {name:"Yƒ∞ƒûƒ∞T KIRKPINAR", class:"2/E"}, {name:"EY√úP OSMAN K√ñKL√úTA≈û", class:"2/E"}, {name:"√áAƒûATAY G√úL", class:"2/E"}, {name:"EDƒ∞Z TA≈ûBUNAR", class:"2/E"}, {name:"ABDULSAMET DEMƒ∞RDA≈û", class:"2/E"}, {name:"Nƒ∞ZAM CAN FAAL", class:"2/E"}, {name:"MUHAMMED EMƒ∞N MURAT", class:"2/E"}, {name:"H√úSEYƒ∞N ENES MURAT", class:"2/E"}, {name:"AYAZ EMƒ∞R NARƒ∞N", class:"2/E"}, {name:"MUHAMMED RUHAYYE", class:"2/E"}, {name:"ASIM EREN ERKAN", class:"2/E"}, {name:"YASƒ∞R SERKAN D√úZ", class:"2/E"},
{name:"Yƒ∞ƒûƒ∞T √áƒ∞FTCƒ∞", class:"2/F"}, {name:"EMƒ∞R KIRKPINAR", class:"2/F"}, {name:"DENƒ∞Z ƒ∞VGEN", class:"2/F"}, {name:"ASYA Dƒ∞LBAZ", class:"2/F"}, {name:"EYL√úL KANBER", class:"2/F"}, {name:"EMƒ∞RHAN KODALAK", class:"2/F"}, {name:"R√úZGAR KODALAK", class:"2/F"}, {name:"FATMA EL√ñMER", class:"2/F"}, {name:"TUANA KOTAN", class:"2/F"}, {name:"AHMED AL ELIWI", class:"2/F"}, {name:"ECRƒ∞N √áAKIR", class:"2/F"}, {name:"ESLƒ∞M Mƒ∞NA ATMACA", class:"2/F"}, {name:"ƒ∞LKNUR SAƒûLAM", class:"2/F"}, {name:"Nƒ∞HAL MIH√áI", class:"2/F"}, {name:"SEVGƒ∞ YANƒû", class:"2/F"}, {name:"Z√úLEYHA AYYILDIZ", class:"2/F"}, {name:"Mƒ∞NEL SENA KARASU", class:"2/F"}, {name:"CEMAL DEMƒ∞REL", class:"2/F"}, {name:"DEFNE G√úLS√úM", class:"2/F"}, {name:"CESUR DEMƒ∞RBA≈û", class:"2/F"}, {name:"FURKAN YA≈ûAR", class:"2/F"}, {name:"ƒ∞SMAƒ∞L EYMEN √ñNC√ú", class:"2/F"}, {name:"POYRAZ √ñZT√úRK", class:"2/F"}, {name:"UMUT √áƒ∞Nƒ∞", class:"2/F"}, {name:"YUSUF CEYLAN", class:"2/F"}, {name:"YUSUF √ñLMEZ", class:"2/F"}, {name:"NEGAM AHMET", class:"2/F"}, {name:"MUSTAFA ATA ARSLAN", class:"2/F"}, {name:"ALƒ∞ ƒ∞KRAM AYDIN", class:"2/F"}, {name:"AHMED EL AHMED", class:"2/F"}, {name:"AZRA MENEK≈ûE", class:"2/F"}, {name:"IRMAK EROƒûLU", class:"2/F"},
{name:"Nƒ∞SANUR √úNAL", class:"2/G"}, {name:"MEVSƒ∞M ≈ûENG√úN", class:"2/G"}, {name:"ALPER √áAKAR", class:"2/G"}, {name:"Cƒ∞HAN BUƒûRA S√ñNMEZ", class:"2/G"}, {name:"KENAN BERK ƒ∞NCƒ∞", class:"2/G"}, {name:"YAƒûIZ DUMAN", class:"2/G"}, {name:"Nƒ∞SANUR BAYTEKƒ∞N", class:"2/G"}, {name:"HAMZA MUSUL", class:"2/G"}, {name:"B√ú≈ûRA AƒûY√úREK", class:"2/G"}, {name:"MEHMET CAN ORHAN", class:"2/G"}, {name:"MUHAMMET Bƒ∞LAL ARSLAN", class:"2/G"}, {name:"NEHƒ∞R EROƒûLU", class:"2/G"}, {name:"Z√úMRA DUMAN", class:"2/G"}, {name:"YAƒûIZ KARAG√úNEY", class:"2/G"}, {name:"POYRAZ LA√áƒ∞NKAYA", class:"2/G"}, {name:"ERTUƒûRUL G√úNE≈û", class:"2/G"}, {name:"VEFA ZENO MAHMALAT", class:"2/G"}, {name:"BAHADDƒ∞N ALLEVƒ∞", class:"2/G"}, {name:"BURAK YA≈ûAR", class:"2/G"}, {name:"DEMƒ∞R KURT", class:"2/G"}, {name:"ESMANUR G√ñZE", class:"2/G"}, {name:"AMƒ∞NE BAHADIR", class:"2/G"}, {name:"SEMƒ∞H SIRA√á KANSU", class:"2/G"}, {name:"ƒ∞LKƒ∞M A√áELYA G√úLMEZ", class:"2/G"}, {name:"BERFƒ∞N ARTUƒû", class:"2/G"}, {name:"ECRƒ∞N Nƒ∞SA Yƒ∞GEN", class:"2/G"}, {name:"√ñYK√ú ATA", class:"2/G"}, {name:"YAƒûMUR KIZIL", class:"2/G"}, {name:"ƒ∞LKE MAVƒ∞BA≈û", class:"2/G"}, {name:"Mƒ∞RA AKBULUT", class:"2/G"}, {name:"G√úL≈ûAH ESMA SEVƒ∞M", class:"2/G"}, {name:"KEREM EGE TURGAY", class:"2/G"}
    ];

    // --- MEVCUT OYUNCULAR (Deƒüi≈üiklik yok, aynƒ± kalacak) ---
    const BASE_PLAYERS = [
        { name: "SALƒ∞H ERDEM YAZAR", class: "2/E", gameId: 2 },
        { name: "Yƒ∞ƒûƒ∞T HAMZA CENGƒ∞Z", class: "2/E", gameId: 2 },
        { name: "√ñYK√ú Tƒ∞RYAKƒ∞", class: "4/A", gameId: 2 },
        { name: "AZRA TOROS", class: "4/A", gameId: 2 },
        { name: "ALƒ∞ AYAZ KAZAN", class: "3/B", gameId: 2 },
        { name: "SONG√úL ESMA AƒûBULUT", class: "3/D", gameId: 2 },
        { name: "√ñMER KA≈ûIK√áI", class: "2/D", gameId: 2 },
        { name: "√ñZNUR DUMAN", class: "3/D", gameId: 2 },
        { name: "MEMDUHA NEHƒ∞R K√ñKSALAN", class: "3/D", gameId: 2 },
        { name: "HAMZA MUSUL", class: "4/F", gameId: 2 },
        { name: "POYRAZ LA√áƒ∞NKAYA", class: "4/F", gameId: 2 },
        { name: "AZƒ∞Z MUHARREM ATƒ∞LA", class: "3/D", gameId: 2 },
        { name: "HAYRUNNƒ∞SA √áE√áEN", class: "2/E", gameId: 2 },
        { name: "√úMRA SUNA KALELƒ∞", class: "4/A", gameId: 2 },
        { name: "DEFNE SULUOƒûLU", class: "4/A", gameId: 2 },

        { name: "ECRƒ∞N √áAKIR", class: "4/E", gameId: 4 },
        { name: "YAƒûMUR KIZIL", class: "4/F", gameId: 4 },
        { name: "MUHAMMED EMƒ∞R KO√áAK", class: "2/E", gameId: 4 },
        { name: "ENES G√úZEL", class: "4/D", gameId: 4 },
        { name: "AY≈ûENUR YILMAZ", class: "2/A", gameId: 4 },
        { name: "AMƒ∞NE BAHADIR", class: "4/F", gameId: 4 },
        { name: "ALƒ∞ AYAZ KAZAN", class: "3/B", gameId: 4 },
        { name: "SONG√úL ESMA AƒûBULUT", class: "3/D", gameId: 4 },
        { name: "YAVUZ SELƒ∞M G√úNE≈û", class: "3/D", gameId: 4 },
        { name: "MELƒ∞SA √áANKAYA", class: "3/D", gameId: 4 },
        { name: "√ñMER KA≈ûIK√áI", class: "2/D", gameId: 4 },
        { name: "√ñZNUR DUMAN", class: "3/D", gameId: 4 },
        { name: "HAMZA MUSUL", class: "4/F", gameId: 4 },
        { name: "POYRAZ LA√áƒ∞NKAYA", class: "4/F", gameId: 4 },
        { name: "HAYRUNNƒ∞SA √áE√áEN", class: "2/E", gameId: 4 }
    ];

    const BIN_ID = "69663710ae596e708fd967a0"; 
    const API_KEY = "$2a$10$jyaUVJ4i7lf8QTCnEWTlpesulUPPq0rODrO1Yy/ljOVLKy.FVU1M2"; 
    const GAMES = [ { id: 2, name: "Abluka" }, { id: 4, name: "Equilibrio" } ];

    let systemData = { status: "registration", players: [...BASE_PLAYERS], brackets: {} };
    let isAdmin = false;
    let activeTabGameId = 2;
    let selectedStudent = null; 

    window.onload = async () => { await loadData(); setInterval(loadData, 5000); };

    // --- AKILLI ARAMA MANTIƒûI ---
    const searchInput = document.getElementById('student-search');
    const resultsBox = document.getElementById('search-results');

    searchInput.addEventListener('input', function(e) {
        const val = e.target.value.toUpperCase();
        if(val.length < 2) { resultsBox.style.display = 'none'; return; }

        const matches = ALL_STUDENTS.filter(s => s.name.startsWith(val));
        resultsBox.innerHTML = '';
        
        if(matches.length > 0) {
            resultsBox.style.display = 'block';
            matches.slice(0, 8).forEach(s => { 
                const div = document.createElement('div');
                div.className = 'search-item';
                div.innerHTML = `<strong>${s.name}</strong><span>${s.class}</span>`;
                div.onclick = () => selectStudent(s);
                resultsBox.appendChild(div);
            });
        } else {
            resultsBox.style.display = 'none';
        }
    });

    function selectStudent(student) {
        selectedStudent = student;
        document.getElementById('search-container').style.display = 'none';
        document.getElementById('selected-student-display').style.display = 'flex';
        document.getElementById('disp-name').innerText = student.name;
        document.getElementById('disp-class').innerText = student.class;
        resultsBox.style.display = 'none';
        searchInput.value = '';
    }

    function clearSelection() {
        selectedStudent = null;
        document.getElementById('search-container').style.display = 'block';
        document.getElementById('selected-student-display').style.display = 'none';
        searchInput.focus();
    }

    // --- Dƒ∞ƒûER FONKSƒ∞YONLAR ---
    async function loadData() {
        try {
            if(BIN_ID.length < 5) {
                const local = localStorage.getItem('merkezV25');
                if(local) systemData = JSON.parse(local);
                updateUI(); document.getElementById('loading-overlay').style.display = 'none'; return;
            }
            const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { 'X-Master-Key': API_KEY } });
            if(res.ok) { const json = await res.json(); if (Object.keys(json.record).length === 0) { await saveData(); } else { systemData = json.record; } updateUI(); }
        } catch(e) {} document.getElementById('loading-overlay').style.display = 'none';
    }

    async function saveData() {
        document.getElementById('loading-overlay').style.display = 'flex';
        try {
            if(BIN_ID.length < 5) { localStorage.setItem('merkezV25', JSON.stringify(systemData)); } 
            else { await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY }, body: JSON.stringify(systemData) }); }
        } catch(e) { alert("Kaydetme hatasƒ±!"); }
        document.getElementById('loading-overlay').style.display = 'none'; updateUI();
    }

    function updateUI() {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        if (isAdmin) { document.getElementById('admin-view').classList.add('active'); renderAdminPanel(); }
        else {
            if (systemData.status === 'registration') document.getElementById('registration-view').classList.add('active');
            else if (systemData.status === 'closed') document.getElementById('waiting-view').classList.add('active');
            else if (systemData.status === 'active') { document.getElementById('tournament-view').classList.add('active'); renderTournamentTabs(); renderBracket(activeTabGameId); }
        }
    }

    async function registerStudent() {
        if(!selectedStudent) { alert("L√ºtfen listeden bir √∂ƒürenci se√ßiniz."); return; }
        const gameId = parseInt(document.getElementById('reg-game').value);

        const exists = systemData.players.some(p => p.name === selectedStudent.name && p.class === selectedStudent.class && p.gameId === gameId);
        if(exists) { alert("Zaten kayƒ±tlƒ±sƒ±nƒ±z!"); return; }

        systemData.players.push({ name: selectedStudent.name, class: selectedStudent.class, gameId });
        alert("Kayƒ±t Ba≈üarƒ±lƒ±!");
        clearSelection();
        await saveData();
    }

    function adminLogin() { const pass = prompt("Kurum Kodu:"); if(pass === "853256") { isAdmin = true; updateUI(); } else { alert("Hatalƒ± ≈ûifre"); } }

    function renderAdminPanel() {
        document.getElementById('count-abluka').innerText = systemData.players.filter(p => p.gameId === 2).length;
        document.getElementById('count-equilibrio').innerText = systemData.players.filter(p => p.gameId === 4).length;
        let statusText = "Kayƒ±t A√ßƒ±k"; if(systemData.status === 'closed') statusText = "Kayƒ±t Kapalƒ±"; if(systemData.status === 'active') statusText = "Turnuva Ba≈üladƒ±";
        document.getElementById('status-text').innerText = statusText;
        const listEl = document.getElementById('admin-player-list'); listEl.innerHTML = '';
        systemData.players.forEach((p, index) => {
            const gameObj = GAMES.find(g => g.id === p.gameId); const gameName = gameObj ? gameObj.name : "-";
            listEl.innerHTML += `<div class="player-item"><div><strong>${p.name}</strong> <span style="color:#aaa">(${p.class})</span><span style="color:var(--primary); font-size:0.8rem; margin-left:10px;">${gameName}</span></div><button class="del-btn" onclick="deletePlayer(${index})">Sil</button></div>`;
        });
    }

    async function deletePlayer(index) { if(confirm("Silinsin mi?")) { systemData.players.splice(index, 1); await saveData(); } }
    async function changeStatus(newStatus) { systemData.status = newStatus; await saveData(); }
    async function resetSystem() { if(confirm("Sƒ±fƒ±rlansƒ±n mƒ±?")) { systemData.status = 'registration'; systemData.players = [...BASE_PLAYERS]; systemData.brackets = {}; await saveData(); } }

    async function startTournament() {
        if(confirm("Turnuva Ba≈ülatƒ±lsƒ±n mƒ±?")) {
            systemData.brackets = {};
            GAMES.forEach(game => {
                const participants = systemData.players.filter(p => p.gameId === game.id);
                participants.sort(() => Math.random() - 0.5);
                systemData.brackets[game.id] = generateBracket(participants);
            });
            systemData.status = 'active'; await saveData();
        }
    }

    function generateBracket(participants) {
        const rounds = []; let matches = []; let power = 1; while(power < participants.length) power *= 2;
        let pIndex = 0;
        for(let i=0; i<power/2; i++) {
            let p1 = participants[pIndex++] || null; let p2 = participants[pIndex++] || null;
            matches.push({ id: Math.random().toString(36).substr(2, 9), p1: p1, p2: p2, s1: 0, s2: 0, winner: (!p2 && p1) ? p1 : null });
        }
        rounds.push(matches);
        let matchCount = matches.length;
        while(matchCount > 1) {
            matchCount /= 2; let nextRound = [];
            for(let i=0; i<matchCount; i++) nextRound.push({ id: Math.random().toString(36).substr(2, 9), p1: null, p2: null, s1:0, s2:0, winner: null });
            rounds.push(nextRound);
        }
        return rounds;
    }

    function showTournamentViewAdmin() { document.getElementById('admin-view').classList.remove('active'); document.getElementById('tournament-view').classList.add('active'); renderTournamentTabs(); renderBracket(activeTabGameId); }
    function renderTournamentTabs() { const c = document.getElementById('game-tabs'); c.innerHTML = ''; GAMES.forEach(g => { c.innerHTML += `<button class="tab-btn ${g.id === activeTabGameId ? 'active' : ''}" onclick="switchTab(${g.id})">${g.name}</button>`; }); }
    function switchTab(id) { activeTabGameId = id; renderTournamentTabs(); renderBracket(id); }

    function renderBracket(gameId) {
        const rounds = systemData.brackets[gameId]; if(!rounds) return;
        const c = document.getElementById('bracket-area'); c.innerHTML = '';
        rounds.forEach((round, rIndex) => {
            let title = `${rIndex + 1}. TUR`; if(rIndex === rounds.length - 1) title = "üèÜ Fƒ∞NAL";
            let html = `<div class="round-block"><div class="round-title">${title}</div><div class="matches-grid">`;
            round.forEach((match, mIndex) => {
                const isCompleted = match.winner !== null;
                const p1Name = match.p1 ? match.p1.name : '...'; const p2Name = match.p2 ? match.p2.name : '...';
                let controls1 = '', controls2 = '';
                if(isAdmin && !match.winner && match.p1 && match.p2) {
                    controls1 = `<div class="score-controls"><button class="btn-s btn-minus" onclick="updateScore(${gameId}, ${rIndex}, ${mIndex}, 1, -1)">-</button><button class="btn-s btn-plus" onclick="updateScore(${gameId}, ${rIndex}, ${mIndex}, 1, 1)">+</button></div>`;
                    controls2 = `<div class="score-controls"><button class="btn-s btn-minus" onclick="updateScore(${gameId}, ${rIndex}, ${mIndex}, 2, -1)">-</button><button class="btn-s btn-plus" onclick="updateScore(${gameId}, ${rIndex}, ${mIndex}, 2, 1)">+</button></div>`;
                }
                html += `<div class="match-card ${isCompleted ? 'completed' : ''}">
                    ${isCompleted ? '<div class="status-badge">Bƒ∞TTƒ∞</div>' : ''}
                    <div class="player-row ${match.winner && match.winner.name === p1Name ? 'winner' : ''}"><div><div class="p-name">${p1Name}</div><div class="p-class">${match.p1 ? match.p1.class : ''}</div></div><div style="display:flex;align-items:center;gap:5px;">${controls1}<div class="score-val">${match.s1}</div></div></div>
                    <div class="player-row ${match.winner && match.winner.name === p2Name ? 'winner' : ''}"><div><div class="p-name">${p2Name}</div><div class="p-class">${match.p2 ? match.p2.class : ''}</div></div><div style="display:flex;align-items:center;gap:5px;">${controls2}<div class="score-val">${match.s2}</div></div></div>
                </div>`;
            });
            html += `</div></div>`; c.innerHTML += html;
        });
    }

    async function updateScore(gId, rIdx, mIdx, pNum, change) {
        const match = systemData.brackets[gId][rIdx][mIdx];
        if (pNum === 1) match.s1 = Math.max(0, match.s1 + change); else match.s2 = Math.max(0, match.s2 + change);
        if (match.s1 >= 2) { match.winner = match.p1; advanceWinner(gId, rIdx, mIdx, match.p1); }
        else if (match.s2 >= 2) { match.winner = match.p2; advanceWinner(gId, rIdx, mIdx, match.p2); }
        else { match.winner = null; }
        await saveData();
    }

    function advanceWinner(gId, rIdx, mIdx, winner) {
        const nextRIdx = rIdx + 1;
        if (nextRIdx < systemData.brackets[gId].length) {
            const nextMIdx = Math.floor(mIdx / 2);
            const isTopSlot = (mIdx % 2 === 0);
            const nextMatch = systemData.brackets[gId][nextRIdx][nextMIdx];
            if (isTopSlot) nextMatch.p1 = winner; else nextMatch.p2 = winner;
        }
    }
</script>
</body>
</html>
