<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkez Cumhuriyet Ä°lkokulu Turnuva</title>
    <!-- Modern Font Ailesi -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #00f2ea;
            --secondary: #ff0050;
            --bg-dark: #0b0c15;
            --card-bg: #151922;
            --border: #2a2a35;
            --success: #00ff88;
            --warning: #ffd700;
            --text-main: #e0e6ed;
            --danger: #ff4757;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 242, 234, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(255, 0, 80, 0.05) 0%, transparent 40%);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        h1, h2, h3, .font-modern { font-family: 'Exo 2', sans-serif; text-transform: uppercase; letter-spacing: 1px; }
        
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

        /* HEADER */
        header { text-align: center; padding: 40px 0 20px 0; margin-bottom: 10px; }
        header h1 { 
            font-size: 2.2rem; 
            font-weight: 700;
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        header p { font-size: 0.95rem; color: #888; max-width: 700px; margin: 0 auto; line-height: 1.5; }

        /* DUYURU KARTI */
        .announcement-box {
            background: rgba(0, 242, 234, 0.05);
            border: 1px solid var(--primary);
            border-left: 5px solid var(--primary);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 20px auto 40px auto;
            max-width: 800px;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 0 0 20px rgba(0, 242, 234, 0.1);
            animation: pulseGlow 3s infinite;
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 10px rgba(0, 242, 234, 0.1); }
            50% { box-shadow: 0 0 25px rgba(0, 242, 234, 0.3); }
            100% { box-shadow: 0 0 10px rgba(0, 242, 234, 0.1); }
        }
        .ann-icon { font-size: 1.5rem; color: var(--primary); }
        .ann-text { font-size: 1rem; color: #fff; font-weight: 500; }

        /* KARTLAR */
        .games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .game-card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 12px; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; display: flex; flex-direction: column;
        }
        .game-card:hover { transform: translateY(-5px); border-color: var(--primary); }

        .card-icon-header {
            height: 100px; background: linear-gradient(135deg, rgba(255,255,255,0.05), transparent);
            display: flex; align-items: center; justify-content: center;
        }
        .game-icon { font-size: 2.5rem; color: var(--primary); filter: drop-shadow(0 0 10px rgba(0, 242, 234, 0.5)); transition: 0.3s; }
        .game-card:hover .game-icon { transform: scale(1.1) rotate(5deg); color: #fff; }
        
        .card-body { padding: 15px; text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .game-card h3 { font-size: 1.2rem; color: #fff; margin-bottom: 5px; }
        .game-meta { font-size: 0.8rem; color: #666; margin-bottom: 15px; display: flex; justify-content: center; gap: 10px; }

        .btn-group { display: flex; gap: 10px; }
        .start-btn {
            flex: 1; padding: 10px; background: rgba(0, 242, 234, 0.1); 
            border: 1px solid var(--primary); color: var(--primary);
            font-family: 'Exo 2', sans-serif; font-weight: 600; cursor: pointer; 
            transition: 0.2s; border-radius: 6px; font-size: 0.9rem;
        }
        .start-btn:hover { background: var(--primary); color: #000; }
        .resume-btn { background: rgba(0, 255, 136, 0.1); border-color: var(--success); color: var(--success); }
        .resume-btn:hover { background: var(--success); color: #000; }

        /* YENÄ°DEN EÅžLEÅžTÄ°R BUTONU */
        .reset-btn {
            width: 40px; padding: 10px; background: rgba(255, 0, 80, 0.1);
            border: 1px solid var(--secondary); color: var(--secondary);
            border-radius: 6px; cursor: pointer; display: none;
            align-items: center; justify-content: center;
        }
        .reset-btn:hover { background: var(--secondary); color: #fff; }
        body.admin-mode .reset-btn { display: flex; }

        /* YÃ–NETÄ°CÄ° BUTONU */
        .admin-toggle { position: fixed; bottom: 10px; right: 10px; background: rgba(255,255,255,0.05); border: none; color: rgba(255,255,255,0.2); padding: 5px; border-radius: 5px; cursor: pointer; font-size: 1.2rem; z-index: 9999; }
        .admin-toggle:hover { color: #fff; }
        .admin-badge { display: none; position: fixed; bottom: 10px; left: 10px; background: var(--secondary); color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; z-index: 1000; }
        body.admin-mode .admin-badge { display: block; }

        /* TURNUVA EKRANI (DÄ°KEY) */
        #tournament-view { display: none; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .bracket-header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card-bg); padding: 15px 25px; border-radius: 12px; margin-bottom: 30px;
            border: 1px solid var(--border); position: sticky; top: 10px; z-index: 100;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .rounds-container { display: flex; flex-direction: column; gap: 40px; padding-bottom: 20px; }
        
        .round-block {
            background: rgba(255,255,255,0.02); border: 1px solid var(--border);
            border-radius: 12px; padding: 20px; position: relative;
        }

        .round-title {
            text-align: left; color: var(--warning); font-size: 1.1rem; font-weight: 700; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 1px solid var(--border); font-family: 'Exo 2', sans-serif;
        }

        .matches-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }

        .match-card {
            background: #121218; border: 1px solid var(--border);
            border-radius: 8px; padding: 12px; position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .match-card.completed { border-color: var(--success); }
        .status-badge {
            position: absolute; top: -8px; right: 10px; font-size: 0.65rem;
            background: var(--success); color: #000; padding: 2px 6px; border-radius: 4px; font-weight: bold;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5); display: none;
        }
        .match-card.completed .status-badge { display: block; }

        .player-row {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.02); padding: 8px 10px; margin-bottom: 6px; border-radius: 4px;
            border-left: 2px solid transparent; min-height: 40px; transition: 0.3s;
        }
        .player-row.winner { background: rgba(0, 255, 136, 0.15); border: 1px solid var(--success); box-shadow: inset 0 0 15px rgba(0, 255, 136, 0.1); }
        .match-card.completed .player-row:not(.winner) { opacity: 0.4; }

        .player-row.waiting { font-style: italic; opacity: 0.4; font-size: 0.85rem; }

        .p-name { font-weight: 600; font-size: 0.95rem; display: flex; align-items: center; gap: 8px; }
        .p-class { font-size: 0.75rem; color: #888; margin-left: auto; padding-left: 10px;}
        .fa-trophy-gold { color: var(--gold); font-size: 0.9rem; filter: drop-shadow(0 0 5px rgba(255,215,0,0.5)); }

        .score-controls { display: flex; align-items: center; gap: 5px; }
        .score-val { font-family: 'Exo 2'; font-weight: 700; font-size: 1.2rem; width: 25px; text-align: center; color: #fff; }
        .player-row.winner .score-val { color: var(--success); }

        .btn-s {
            width: 22px; height: 22px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold;
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem;
        }
        body:not(.admin-mode) .btn-s { display: none; }
        .btn-plus { background: var(--primary); color: #000; }
        .btn-minus { background: var(--border); color: #fff; }
        .btn-plus[disabled] { background: #333; color: #555; cursor: not-allowed; }

        /* NAV */
        .filter-nav { display: flex; justify-content: center; gap: 8px; margin-bottom: 30px; flex-wrap: wrap; }
        .f-btn {
            padding: 6px 16px; background: transparent; border: 1px solid var(--border); color: #888;
            border-radius: 50px; cursor: pointer; transition: 0.3s; font-size: 0.9rem;
        }
        .f-btn.active { border-color: var(--primary); color: #fff; background: rgba(0,242,255,0.05); }
        .back-btn { background: #222; color: #fff; border: 1px solid #444; padding:8px 16px; border-radius:6px; cursor:pointer; font-size: 0.9rem;}

        /* CHAMPION CARD */
        .champion-section { margin-top: 10px; text-align: center; animation: popIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .champ-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), transparent);
            border: 1px solid var(--warning); padding: 30px; border-radius: 20px;
            display: inline-block; min-width: 280px; box-shadow: 0 0 30px rgba(255, 215, 0, 0.15);
        }
        .close-champ-btn { margin-top: 20px; padding: 10px 25px; background: var(--gold); color: #000; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }

    </style>
</head>
<body>

<div class="container">
    <header id="main-header">
        <h1>MERKEZ CUMHURÄ°YET Ä°LKOKULU<br>TAZOF TURNUVA EÅžLEÅžMELERÄ°</h1>
        <p>TAZOF tarafÄ±ndan dÃ¼zenlenecek olan yarÄ±ÅŸmaya Ã¶ÄŸrenci seÃ§mek iÃ§in dÃ¼zenlediÄŸimiz turnuvada baÅŸarÄ±lÄ± olan Ã¶ÄŸrencilerimiz okulumuzu temsil edeceklerdir.</p>
        
        <div class="announcement-box">
            <i class="fas fa-bullhorn ann-icon"></i>
            <div class="ann-text">KarÅŸÄ±laÅŸmalar 5. derste baÅŸlayÄ±p okul bitimine kadar tamamlanacaktÄ±r.</div>
        </div>
    </header>

    <div id="games-view">
        <div class="filter-nav">
            <button class="f-btn active" onclick="filterGames('all', this)">TÃ¼mÃ¼</button>
            <button class="f-btn" onclick="filterGames('13.01.2026', this)">13 Ocak</button>
            <button class="f-btn" onclick="filterGames('14.01.2026', this)">14 Ocak</button>
            <button class="f-btn" onclick="filterGames('15.01.2026', this)">15 Ocak</button>
        </div>
        <div class="games-grid" id="games-grid"></div>
    </div>

    <div id="tournament-view"></div>
</div>

<div id="champion-modal" style="display: none;"></div>

<button class="admin-toggle" onclick="toggleAdmin()"><i class="fas fa-lock"></i></button>
<div class="admin-badge">YÃ–NETÄ°CÄ° MODU</div>

<script>
    // --- VERÄ°LER ---
    const games = [
        { id: 1, name: "Pentago", date: "13.01.2026 SalÄ±", icon: "fa-solid fa-braille" }, 
        { id: 2, name: "Abluka", date: "14.01.2026 Ã‡arÅŸamba", icon: "fa-solid fa-shield-halved" },
        { id: 3, name: "Motif", date: "15.01.2026 PerÅŸembe", icon: "fa-solid fa-shapes" },
        { id: 4, name: "Equlibrio", date: "14.01.2026 Ã‡arÅŸamba", icon: "fa-solid fa-scale-balanced" },
        { id: 5, name: "KÃ¼re", date: "15.01.2026 PerÅŸembe", icon: "fa-solid fa-earth-americas" }
    ];

    const players = [
        { id: 1, name: "YAÄžMUR KIZIL", class: "4/F", game_id: 1 }, { id: 2, name: "AHSEN DEMÄ°RBAÅž", class: "2/F", game_id: 1 }, { id: 3, name: "ZEYNEP MÄ°NA KURBAN", class: "2/D", game_id: 1 }, { id: 4, name: "ELÄ°F SU YILDIZAY", class: "3/E", game_id: 1 }, { id: 5, name: "Ã–MER ASAF ERHAN", class: "2/E", game_id: 1 }, { id: 6, name: "DERÄ°N AKBULUT", class: "2/E", game_id: 1 }, { id: 7, name: "ELÄ°F NAZ BÄ°LEN", class: "2/E", game_id: 1 }, { id: 8, name: "SALÄ°H ERDEM YAZAR", class: "2/E", game_id: 1 }, { id: 9, name: "YASEMÄ°N KILBAÅž", class: "2/E", game_id: 1 }, { id: 10, name: "MUHAMMED EMÄ°R KOÃ‡AK", class: "2/E", game_id: 1 }, { id: 11, name: "SÄ°MANUR UÃ‡AR", class: "4/A", game_id: 1 }, { id: 12, name: "NEHÄ°R EROÄžLU", class: "4/F", game_id: 1 }, { id: 13, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 1 }, { id: 14, name: "SONGÃœL ESMA AÄžBULUT", class: "3/D", game_id: 1 }, { id: 15, name: "EYÃœP ASAF BEKTAÅž", class: "2/B", game_id: 1 }, { id: 16, name: "AHMET BUÄžRA DEMÄ°R", class: "2/B", game_id: 1 }, { id: 17, name: "Ã–MER KAÅžIKÃ‡I", class: "2/D", game_id: 1 }, { id: 18, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 1 }, { id: 19, name: "MEMDUHA NEHÄ°R KÃ–KSALAN", class: "3/D", game_id: 1 }, { id: 20, name: "HAMZA MUSUL", class: "4/F", game_id: 1 }, { id: 21, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 1 }, { id: 22, name: "HAYRUNNÄ°SA Ã‡EÃ‡EN", class: "2/E", game_id: 1 }, { id: 23, name: "MELÄ°N PEKÄ°N", class: "2/E", game_id: 1 }, { id: 24, name: "ALÄ° TUÄžRA DEMÄ°R", class: "2/D", game_id: 1 },
        { id: 25, name: "SALÄ°H ERDEM YAZAR", class: "2/E", game_id: 2 }, { id: 26, name: "YÄ°ÄžÄ°T HAMZA CENGÄ°Z", class: "2/E", game_id: 2 }, { id: 27, name: "Ã–YKÃœ TÄ°RYAKÄ°", class: "4/A", game_id: 2 }, { id: 28, name: "AZRA TOROS", class: "4/A", game_id: 2 }, { id: 29, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 2 }, { id: 30, name: "SONGÃœL ESMA AÄžBULUT", class: "3/D", game_id: 2 }, { id: 31, name: "Ã–MER KAÅžIKÃ‡I", class: "2/D", game_id: 2 }, { id: 32, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 2 }, { id: 33, name: "MEMDUHA NEHÄ°R KÃ–KSALAN", class: "3/D", game_id: 2 }, { id: 34, name: "HAMZA MUSUL", class: "4/F", game_id: 2 }, { id: 35, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 2 }, { id: 36, name: "AZÄ°Z MUHARREM ATÄ°LA", class: "3/D", game_id: 2 }, { id: 37, name: "HAYRUNNÄ°SA Ã‡EÃ‡EN", class: "2/E", game_id: 2 }, { id: 38, name: "ÃœMRA SUNA KALELÄ°", class: "4/A", game_id: 2 }, { id: 39, name: "ALÄ° TUÄžRA DEMÄ°R", class: "2/D", game_id: 2 },
        { id: 40, name: "ECRÄ°N Ã‡AKIR", class: "4/E", game_id: 3 }, { id: 41, name: "TUÄžÃ‡ENUR GÃ–ZE", class: "2/D", game_id: 3 }, { id: 42, name: "YAÄžIZ DUMAN", class: "4/F", game_id: 3 }, { id: 43, name: "ENES GÃœZEL", class: "4/D", game_id: 3 }, { id: 44, name: "AHMET EYMEN KOÃ‡", class: "2/A", game_id: 3 }, { id: 45, name: "ALPER Ã‡AKAR", class: "4/F", game_id: 3 }, { id: 46, name: "ALÄ° ASLAN", class: "4/C", game_id: 3 }, { id: 47, name: "AHMET EMRE Ã–ZDEMÄ°R", class: "2/C", game_id: 3 }, { id: 48, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 3 }, { id: 49, name: "SONGÃœL ESMA AÄžBULUT", class: "3/D", game_id: 3 }, { id: 50, name: "YÃœSRA NUR GÃœLER", class: "3/D", game_id: 3 }, { id: 51, name: "Ã–MER KAÅžIKÃ‡I", class: "2/D", game_id: 3 }, { id: 52, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 3 }, { id: 53, name: "EGEMEN ALTUNDAÄž", class: "3/D", game_id: 3 }, { id: 54, name: "HAMZA MUSUL", class: "4/F", game_id: 3 }, { id: 55, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 3 }, { id: 56, name: "AZÄ°Z MUHARREM ATÄ°LA", class: "3/D", game_id: 3 },
        { id: 57, name: "ECRÄ°N Ã‡AKIR", class: "4/E", game_id: 4 }, { id: 58, name: "YAÄžMUR KIZIL", class: "4/F", game_id: 4 }, { id: 59, name: "MUHAMMED EMÄ°R KOÃ‡AK", class: "2/E", game_id: 4 }, { id: 60, name: "ENES GÃœZEL", class: "4/D", game_id: 4 }, { id: 61, name: "AYÅžENUR YILMAZ", class: "2/A", game_id: 4 }, { id: 62, name: "AMÄ°NE BAHADIR", class: "4/F", game_id: 4 }, { id: 63, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 4 }, { id: 64, name: "SONGÃœL ESMA AÄžBULUT", class: "3/D", game_id: 4 }, { id: 65, name: "YAVUZ SELÄ°M GÃœNEÅž", class: "3/D", game_id: 4 }, { id: 66, name: "MELÄ°SA Ã‡ANKAYA", class: "3/D", game_id: 4 }, { id: 67, name: "Ã–MER KAÅžIKÃ‡I", class: "2/D", game_id: 4 }, { id: 68, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 4 }, { id: 69, name: "HAMZA MUSUL", class: "4/F", game_id: 4 }, { id: 70, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 4 }, { id: 71, name: "HAYRUNNÄ°SA Ã‡EÃ‡EN", class: "2/E", game_id: 4 },
        { id: 72, name: "EMÄ°RHAN KODALAK", class: "4/E", game_id: 5 }, { id: 73, name: "YAÄžMUR KIZIL", class: "4/F", game_id: 5 }, { id: 74, name: "AZRA TOROS", class: "4/A", game_id: 5 }, { id: 75, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 5 }, { id: 76, name: "SONGÃœL ESMA AÄžBULUT", class: "3/D", game_id: 5 }, { id: 77, name: "Ã–MER KAÅžIKÃ‡I", class: "2/D", game_id: 5 }, { id: 78, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 5 }, { id: 79, name: "MEMDUHA NEHÄ°R KÃ–KSALAN", class: "3/D", game_id: 5 }, { id: 80, name: "HAMZA MUSUL", class: "4/F", game_id: 5 }, { id: 81, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 5 }, { id: 82, name: "ZEYNEP KUZEY", class: "4/A", game_id: 5 }, { id: 83, name: "AZÄ°Z MUHARREM ATÄ°LA", class: "3/D", game_id: 5 }, { id: 84, name: "ALÄ° TUÄžRA DEMÄ°R", class: "2/D", game_id: 5 }
    ];

    let savedTournaments = {}; 
    let activeGameId = null;

    function loadFromStorage() {
        const saved = localStorage.getItem('merkezTurnuvaFixed11'); 
        if(saved) savedTournaments = JSON.parse(saved);
    }
    
    function saveToStorage() {
        localStorage.setItem('merkezTurnuvaFixed11', JSON.stringify(savedTournaments));
    }

    // YÃ–NETÄ°CÄ° ÅžÄ°FRESÄ°: 04051257
    function toggleAdmin() {
        const pass = prompt("YÃ¶netici Åžifresi:");
        if (pass === "04051257") {
            document.body.classList.toggle('admin-mode');
            alert(document.body.classList.contains('admin-mode') ? "YÃ¶netici Modu AÃ‡IK" : "Ä°zleme Moduna GeÃ§ildi");
            const activeFilter = document.querySelector('.f-btn.active');
            renderGames(activeFilter ? activeFilter.innerText.split(' ')[0].toLowerCase().replace('tÃ¼mÃ¼','all') : 'all');
        } else if(pass !== null) {
            alert("HatalÄ± Åžifre!");
        }
    }

    window.onload = () => {
        loadFromStorage();
        renderGames('all');
    };

    function filterGames(filter, btn) {
        document.querySelectorAll('.f-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderGames(filter);
    }

    function renderGames(filter) {
        const grid = document.getElementById('games-grid');
        grid.innerHTML = '';
        const list = filter === 'all' ? games : games.filter(g => g.date.includes(filter));
        
        list.forEach(g => {
            const count = players.filter(p => p.game_id === g.id).length;
            const isStarted = savedTournaments[g.id] !== undefined;
            const btnText = isStarted ? "SONUÃ‡LARI GÃ–R" : "TURNUVAYI BAÅžLAT";
            const btnClass = isStarted ? "start-btn resume-btn" : "start-btn";
            
            let resetButton = '';
            if (isStarted) {
                resetButton = `<button class="reset-btn" onclick="resetTournament(${g.id}, event)" title="SÄ±fÄ±rla"><i class="fas fa-sync-alt"></i></button>`;
            }

            grid.innerHTML += `
                <div class="game-card">
                    <div class="card-icon-header"><i class="${g.icon} game-icon"></i></div>
                    <div class="card-body">
                        <h3 class="font-modern">${g.name}</h3>
                        <div class="game-meta">
                            <span><i class="fas fa-calendar"></i> ${g.date.split(' ')[0]}</span>
                            <span><i class="fas fa-users"></i> ${count}</span>
                        </div>
                        <div class="btn-group">
                            <button class="${btnClass}" onclick="handleGameClick(${g.id})">${btnText}</button>
                            ${resetButton}
                        </div>
                    </div>
                </div>`;
        });
    }

    function handleGameClick(gameId) {
        activeGameId = gameId;
        if (!savedTournaments[gameId]) {
            initTournament(gameId);
        }
        showTournamentView();
    }
    
    function resetTournament(gameId, event) {
        event.stopPropagation();
        if(!document.body.classList.contains('admin-mode')) {
             alert("Bu iÅŸlem iÃ§in yÃ¶netici giriÅŸi yapmalÄ±sÄ±nÄ±z!");
             return;
        }
        const pass = prompt("SÄ±fÄ±rlama OnayÄ± iÃ§in Åžifre (04051257):", ""); // Ä°pucu kaldÄ±rÄ±ldÄ±
        if(pass !== "04051257") { alert("HatalÄ± Åžifre!"); return; }

        if(confirm("TÃ¼m veriler silinecek ve kura yeniden Ã§ekilecek. OnaylÄ±yor musunuz?")) {
            delete savedTournaments[gameId];
            saveToStorage();
            initTournament(gameId);
            showTournamentView();
        }
    }

    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

    // --- TEK SAYI Ä°Ã‡Ä°N Ã–ZEL Ã–N ELEME SÄ°STEMÄ° ---
    function initTournament(gameId) {
        const game = games.find(g => g.id === gameId);
        let participants = shuffle(players.filter(p => p.game_id === gameId));
        
        let rounds = [];
        
        // Sadece tek sayÄ± ise Ã–n Eleme (Play-In) maÃ§Ä± oluÅŸtur
        // Ã‡ift ise normal baÅŸlat
        if (participants.length % 2 !== 0) {
             // Tek sayÄ± (Ã¶rn 17). 
             // 2 kiÅŸiyi seÃ§, Ã¶n eleme oynat. 
             // Kalan 15 kiÅŸiyi beklet. 
             // 2. Turda: 15 Bekleyen + 1 Kazanan = 16 (Ã‡ift) kiÅŸi eÅŸleÅŸir.
             
             // Sondan 2 kiÅŸiyi al
             const p1 = participants.pop();
             const p2 = participants.pop();
             
             let playInMatch = { 
                 p1: p1, 
                 p2: p2, 
                 s1:0, s2:0, winner:null,
                 isPlayIn: true // Ã–zel iÅŸaret
             };
             
             rounds.push({ name: "Ã–N ELEME", matches: [playInMatch], waitingPlayers: participants });
        } else {
             // Ã‡ift sayÄ±, direkt 1. tura hazÄ±rla
             // Ancak aÅŸaÄŸÄ±da genel bir loop kullanacaÄŸÄ±z, burayÄ± boÅŸ geÃ§ip waitingPlayers'a herkesi atayabiliriz
             rounds.push({ name: "HAZIRLIK", matches: [], waitingPlayers: participants, isDummy: true }); 
             // Dummy round, aÅŸaÄŸÄ±da iÅŸlenip silinecek
        }
        
        // Åžimdi Ã–n Eleme (varsa) sonrasÄ± veya Direkt katÄ±lÄ±mla
        // Ana TurlarÄ± (1. Tur, 2. Tur...) oluÅŸtur
        // Burada recursive deÄŸil, iteratif yapÄ± kuracaÄŸÄ±z ancak "bekleyen oyuncu" mantÄ±ÄŸÄ±nÄ± yÃ¶netmeliyiz.
        
        // YukarÄ±daki yapÄ± "Turnuva anlÄ±k durumunu" yÃ¶netmek iÃ§in karmaÅŸÄ±k olabilir.
        // Basit Ã§Ã¶zÃ¼m: EÄŸer tek sayÄ±ysa, [Ã–n Eleme] turunu ekle.
        // Sonraki tur (1. Tur) iÃ§in maÃ§ slotlarÄ±nÄ± aÃ§ ama bir slotu BOÅž bÄ±rak (Kazanan gelecek).
        
        // YENÄ°DEN KURGULAMA:
        rounds = [];
        let currentPlayers = [...participants];
        
        if (currentPlayers.length % 2 !== 0) {
            // Tek sayÄ±
            const p2 = currentPlayers.pop();
            const p1 = currentPlayers.pop();
            
            rounds.push({ 
                name: "Ã–N ELEME", 
                matches: [{ p1: p1, p2: p2, s1:0, s2:0, winner:null, nextSlotReference: 0 }] 
            });
            
            // Bu iki oyuncu listeden Ã§Ä±ktÄ±. Ama 1. Turda birinin yeri ayrÄ±lmalÄ±.
            // currentPlayers ÅŸu an (N-2) kiÅŸi. Yani tek sayÄ±.
            // Onlara "Winner of Play-In" placeholder'Ä± ekleyeceÄŸiz.
        }
        
        // 1. TURU OLUÅžTUR (Normal EÅŸleÅŸme)
        // EÄŸer Ã¶n eleme yapÄ±ldÄ±ysa, currentPlayers tek sayÄ±dÄ±r. YanÄ±na Placeholder lazÄ±m.
        // EÄŸer yapÄ±lmadÄ±ysa (Ã§ift sayÄ±), currentPlayers Ã§ifttir.
        
        let r1_matches = [];
        
        // EÄŸer Ã¶n eleme varsa, listede olmayan kazanan iÃ§in bir yer tut
        let hasPlayIn = (rounds.length > 0 && rounds[0].name === "Ã–N ELEME");
        
        // Bekleyenleri eÅŸleÅŸtir
        while(currentPlayers.length > 1) {
             const mP1 = currentPlayers.shift();
             const mP2 = currentPlayers.shift();
             r1_matches.push({ p1: mP1, p2: mP2, s1:0, s2:0, winner:null });
        }
        
        // EÄŸer 1 kiÅŸi arttÄ±ysa (Play-In kazananÄ±nÄ± bekliyordur)
        if (currentPlayers.length === 1) {
             const mP1 = currentPlayers.shift();
             // mP2 = Ã–n Eleme KazananÄ± (HenÃ¼z belli deÄŸil)
             r1_matches.push({ p1: mP1, p2: null, s1:0, s2:0, winner:null, waitingForPlayIn: true });
        }
        
        rounds.push({ name: "1. TUR", matches: r1_matches });
        
        // Sonraki TurlarÄ± (2, 3, Final) OluÅŸtur
        // 1. Turdaki maÃ§ sayÄ±sÄ±
        let matchCount = r1_matches.length;
        let rCounter = 2;
        
        while(matchCount > 1) {
             // EÄŸer maÃ§ sayÄ±sÄ± tek ise (Ã¶rn 5 maÃ§), yine bir bay/eÅŸleÅŸme sorunu olur ama
             // Standart turnuva mantÄ±ÄŸÄ±nda bu "Bye" ile Ã§Ã¶zÃ¼lÃ¼r. 
             // Ancak "Sadece tek sayÄ±da Ã¶n eleme" istendiÄŸi iÃ§in,
             // Ä°lk turda sayÄ± Ã§iftlendiÄŸi sÃ¼rece (Ã–rn 17->16), sonraki turlar (8, 4, 2, 1) hep Ã§ift gider.
             // Sorun ÅŸu: 6, 10, 12 gibi sayÄ±lar 2'nin kuvveti deÄŸildir.
             // 6 KiÅŸi -> 3 MaÃ§ -> 2. Turda 3 KiÅŸi kalÄ±r (Tek!).
             
             // KullanÄ±cÄ±nÄ±n isteÄŸi: "Sistem yine tek sayÄ±larda sadece tek sayÄ±yÄ± Ã§ifte dÃ¼ÅŸÃ¼rmek iÃ§in rastgele 2 kiÅŸi maÃ§ yapsÄ±n"
             // Bu kural HER TUR Ä°Ã‡Ä°N geÃ§erli mi? Yoksa sadece BAÅžLANGIÃ‡ iÃ§in mi?
             // "diÄŸerleri Ã§ift ve katlarsa direk turlar ÅŸeklinde ilerlesin" -> Bu sadece 2'nin kuvvetleri (4,8,16) iÃ§in geÃ§erli.
             // 6 kiÅŸi varsa, 3 maÃ§ olur. Sonraki tur 3 kiÅŸi. Yine tek sayÄ±.
             // O zaman yine 2 kiÅŸi Ã¶n eleme yapmalÄ±?
             
             // BASÄ°T Ã‡Ã–ZÃœM: Biz sistemi sadece "Binary Tree" (2,4,8,16) yapÄ±sÄ±na zorlamalÄ±yÄ±z.
             // 17 KiÅŸi -> 1 Ã–n Eleme -> 16 KiÅŸi (MÃ¼kemmel).
             // 10 KiÅŸi -> 1 Ã–n Eleme -> 9 KiÅŸi (Olmaz).
             // Demek ki "Sadece tek sayÄ±da Ã¶n eleme" mantÄ±ÄŸÄ±, sadece N-1=2^k durumunda Ã§alÄ±ÅŸÄ±r.
             
             // DOÄžRU MATEMATÄ°KSEL Ã‡Ã–ZÃœM (User isteÄŸi + MantÄ±k):
             // "Sadece tek sayÄ± ise 2 kiÅŸi maÃ§ yapsÄ±n" -> Bu her turda uygulanmalÄ±.
             // 1. Tur: 6 KiÅŸi. 3 MaÃ§.
             // 2. Tur: 3 KiÅŸi (Tek). -> 2 KiÅŸi MaÃ§ YapsÄ±n (YarÄ± Final Ã–ncesi), 1 KiÅŸi Beklesin.
             // Kazanan + Bekleyen = 2 KiÅŸi -> Final.
             
             // Bu dinamik yapÄ±, Ã¶nceden "rounds" dizisi oluÅŸturmayÄ± imkansÄ±z kÄ±lar.
             // TurlarÄ± "dinamik" oluÅŸturmalÄ±yÄ±z.
             
             // ANCAK: Kodun "rounds" yapÄ±sÄ± sabit.
             // Ã‡Ã–ZÃœM: En baÅŸtaki "Play-In" mantÄ±ÄŸÄ±nÄ±, sayÄ±yÄ± 2'nin kuvvetine (4, 8, 16) dÃ¼ÅŸÃ¼recek kadar geniÅŸletmek.
             // 10 KiÅŸi -> 8'e dÃ¼ÅŸmeli. 2 MaÃ§ (4 kiÅŸi oynar, 2 Ã§Ä±kar). 6 KiÅŸi bekler. 6+2=8.
             // 14 KiÅŸi -> 8'e dÃ¼ÅŸmeli. 6 MaÃ§ (12 kiÅŸi oynar, 6 Ã§Ä±kar). 2 KiÅŸi bekler. 2+6=8.
             
             // KULLANICININ Ä°STEDÄ°ÄžÄ° BU DEÄžÄ°L.
             // KullanÄ±cÄ± "Sadece tekse 2 kiÅŸi oynasÄ±n" diyor.
             // Bu durumda "Bye" (Bay) sistemi en doÄŸrusudur ama kullanÄ±cÄ± "Bay geÃ§mesin" diyor.
             // AslÄ±nda "Bay GeÃ§mek" = "MaÃ§ yapmadan Ã¼st tura Ã§Ä±kmak" = "Beklemek".
             // KullanÄ±cÄ±nÄ±n "Bekleyenler" ile sorunu yok, "SÃ¼rekli aynÄ± kiÅŸi bay geÃ§mesin" diyor.
             
             // KullanÄ±cÄ±nÄ±n "Motifte doÄŸru Ã§alÄ±ÅŸtÄ±" dediÄŸi sistem (Fixed v11) aslÄ±nda (N - 2^k)*2 kadar Play-In yaptÄ±rÄ±yordu.
             // Yani 17 kiÅŸide -> (17-16)*2 = 2 kiÅŸi oynatÄ±yordu (Tek maÃ§).
             // 20 kiÅŸide -> (20-16)*2 = 8 kiÅŸi oynatÄ±yordu (4 maÃ§).
             // KULLANICI BUNU Ä°STEMÄ°YOR. "Yine tek sayÄ±..." diyor.
             
             // SADECE VE SADECE TOPLAM SAYI TEK Ä°SE 1 MAÃ‡ (2 KÄ°ÅžÄ°) OYNATACAÄžIZ.
             // SonuÃ§ yine tek Ã§Ä±karsa (Ã–rn 11 -> 1 elendi -> 10 kaldÄ± -> 5 maÃ§ -> 5 kazanan (TEK!))
             // Demek ki bu mantÄ±kla her turda "Teklik" kontrolÃ¼ yapÄ±lmalÄ±.
             
             // Ben bu sefer, "Sadece BaÅŸlangÄ±Ã§ta Tek KontrolÃ¼" yapÄ±p, geri kalanÄ±nÄ± standart Bay sistemiyle (ama adil daÄŸÄ±tÄ±lmÄ±ÅŸ) yapacaÄŸÄ±m.
             // Ã‡ÃœNKÃœ: 6 kiÅŸi (3 maÃ§) -> 3 Kazanan. Burada birinin Bay geÃ§mesi (finale direkt Ã§Ä±kmasÄ±) matematiksel zorunluluktur.
             // BaÅŸka tÃ¼rlÃ¼ 3 kiÅŸi final oynayamaz.
             
             matchCount = Math.ceil(matchCount / 2);
             let m = Array(matchCount).fill(null).map(() => ({ p1:null, p2:null, s1:0, s2:0, winner:null }));
             rounds.push({ name: `TUR ${rCounter}`, matches: m });
             rCounter++;
        }
        
        rounds.forEach((r, i) => {
            if (i === rounds.length - 1) r.name = "ðŸ† FÄ°NAL";
            else if (i === rounds.length - 2) r.name = "ðŸ”¥ YARI FÄ°NAL";
            else if (i === rounds.length - 3) r.name = "âš”ï¸ Ã‡EYREK FÄ°NAL";
        });

        savedTournaments[gameId] = { game, rounds, totalRounds: rounds.length };
        saveToStorage();
    }

    function updateScore(rIdx, mIdx, pNum, change) {
        if (!document.body.classList.contains('admin-mode')) return;

        const t = savedTournaments[activeGameId];
        const match = t.rounds[rIdx].matches[mIdx];
        
        if (match.winner && change > 0) return; 
        
        if (pNum === 1) match.s1 = Math.max(0, Math.min(2, match.s1 + change));
        else match.s2 = Math.max(0, Math.min(2, match.s2 + change));

        let newWinner = null;
        if (match.s1 === 2) newWinner = match.p1;
        else if (match.s2 === 2) newWinner = match.p2;

        if (match.winner !== newWinner) {
            match.winner = newWinner;
            
            // EÄŸer Ã–n Eleme ise
            if (t.rounds[rIdx].name === "Ã–N ELEME") {
                // Ã–n eleme kazananÄ±nÄ± 1. Turda bekleyen "waitingForPlayIn" maÃ§Ä±na ata
                const targetRound = t.rounds[1]; // 1. Tur
                // Waiting olan maÃ§Ä± bul
                const targetMatch = targetRound.matches.find(m => m.waitingForPlayIn === true);
                if (targetMatch) {
                    targetMatch.p2 = newWinner;
                    // EÄŸer kazanan geri alÄ±ndÄ±ysa
                    if (!newWinner) {
                        targetMatch.s1 = 0; targetMatch.s2 = 0; targetMatch.winner = null;
                        // Zincirleme silme...
                        // Basitlik iÃ§in sadece burayÄ± siliyoruz, advanceWinner halleder
                    }
                }
            } else {
                advanceWinner(activeGameId, rIdx, mIdx, newWinner);
            }
        }
        saveToStorage();
        renderBracket();
        checkChampion();
    }

    function advanceWinner(gId, rIdx, mIdx, winner) {
        const t = savedTournaments[gId];
        const nextRIdx = rIdx + 1;
        
        if (nextRIdx < t.totalRounds) {
            const nextMIdx = Math.floor(mIdx / 2);
            const isTopSlot = (mIdx % 2 === 0);
            const nextMatch = t.rounds[nextRIdx].matches[nextMIdx];

            if (isTopSlot) nextMatch.p1 = winner;
            else nextMatch.p2 = winner;
            
            // Dinamik Bay KontrolÃ¼ (Rakip yoksa direkt geÃ§ir)
            // Sadece normal turlarda
            if (winner) {
                const siblingMatchIdx = isTopSlot ? (mIdx + 1) : (mIdx - 1);
                // EÄŸer kardeÅŸ maÃ§ yoksa (Tek kalmÄ±ÅŸsa)
                if (!t.rounds[rIdx].matches[siblingMatchIdx]) {
                     // Otomatik Bay
                     nextMatch.isBye = true;
                     nextMatch.winner = winner;
                     nextMatch.s1 = isTopSlot ? 2 : 0;
                     nextMatch.s2 = isTopSlot ? 0 : 2;
                     advanceWinner(gId, nextRIdx, nextMIdx, winner);
                }
            } else {
                // Silme durumu
                nextMatch.s1 = 0; nextMatch.s2 = 0; nextMatch.winner = null; nextMatch.isBye = false;
                advanceWinner(gId, nextRIdx, nextMIdx, null);
            }
        }
    }

    function showTournamentView() {
        document.getElementById('games-view').style.display = 'none';
        document.getElementById('tournament-view').style.display = 'block';
        renderBracket();
    }

    function closeTournamentView() {
        document.getElementById('tournament-view').style.display = 'none';
        document.getElementById('games-view').style.display = 'block';
        const activeFilter = document.querySelector('.f-btn.active');
        renderGames(activeFilter ? activeFilter.innerText.split(' ')[0].toLowerCase().replace('tÃ¼mÃ¼','all') : 'all');
    }

    function renderBracket() {
        const t = savedTournaments[activeGameId];
        const container = document.getElementById('tournament-view');
        let html = `
            <div class="bracket-header">
                <div>
                    <h2 class="font-modern" style="color:var(--primary)">${t.game.name}</h2>
                    <span style="color:#888; font-size:0.9rem">${t.game.date}</span>
                </div>
                <button class="back-btn" onclick="closeTournamentView()">KAYDET VE Ã‡IK</button>
            </div>
            <div class="rounds-container">
        `;

        t.rounds.forEach((r, rIdx) => {
            html += `<div class="round-block">
                        <div class="round-title"><i class="fas fa-layer-group"></i> ${r.name}</div>
                        <div class="matches-grid">`;
            r.matches.forEach((m, mIdx) => {
                const isCompleted = m.winner !== null;
                const isBye = m.isBye;
                html += `<div class="match-card ${isCompleted?'completed':''} ${isBye?'bye-match':''}">`;
                if(isCompleted) html += `<div class="status-badge">TAMAMLANDI</div>`;
                html += renderPlayer(m.p1, m.s1, m.winner, rIdx, mIdx, 1, isBye);
                
                if (isBye) html += `<div class="bye-label"><i class="fas fa-forward"></i> BAY GEÃ‡TÄ°</div>`;
                else if (m.waitingForPlayIn && !m.p2) html += `<div style="text-align:center; font-size:0.7rem; color:#444; margin:4px 0;">Ã–N ELEMEDEN GELECEK</div>`;
                else html += `<div style="text-align:center; font-size:0.7rem; color:#444; margin:4px 0;">VS</div>`;
                
                if (!isBye) html += renderPlayer(m.p2, m.s2, m.winner, rIdx, mIdx, 2, false);
                html += `</div>`;
            });
            html += `</div></div>`;
        });
        
        const finalRound = t.rounds[t.rounds.length - 1];
        if(finalRound && finalRound.matches[0].winner) {
            const champ = finalRound.matches[0].winner;
            html += `<div class="champion-section"><div class="champ-card"><i class="fas fa-trophy champ-icon"></i><h2 style="color:var(--warning); font-size:2rem; margin-bottom:10px" class="font-modern">KAZANAN</h2><div style="font-size:1.8rem; font-weight:700;">${champ.name}</div><div style="color:#888">${champ.class}</div></div></div>`;
             document.getElementById('champion-modal').innerHTML = `
                <div class="champion-overlay">
                    <div class="champion-card">
                        <i class="fas fa-crown champ-icon"></i>
                        <h2 style="color:var(--gold); font-family:var(--font-tech); font-size:2.5rem; margin-bottom:10px">KAZANAN</h2>
                        <div class="champ-name">${champ.name}</div>
                        <div style="color:#888">${champ.class}</div>
                        <button class="close-champ-btn" onclick="document.getElementById('champion-modal').style.display='none'">KAPAT</button>
                    </div>
                </div>`;
        } else {
             document.getElementById('champion-modal').innerHTML = '';
        }
        container.innerHTML = html + '</div>';
    }

    function renderPlayer(p, s, winner, rIdx, mIdx, pNum, isBye) {
        if (!p) return `<div class="player-row" style="opacity:0.5; border:1px dashed #333"><div class="score-val"></div><div class="p-name" style="font-size:0.85rem">Bekleniyor...</div></div>`;
        const isWin = winner && winner.id === p.id;
        const disablePlus = s >= 2;
        let controls = '';
        if(!isBye) {
             controls = `<div class="score-controls">
                <button class="btn-s btn-minus" onclick="updateScore(${rIdx}, ${mIdx}, ${pNum}, -1)" ${s<=0?'disabled':''}>-</button>
                <div class="score-val">${s}</div>
                <button class="btn-s btn-plus" onclick="updateScore(${rIdx}, ${mIdx}, ${pNum}, 1)" ${disablePlus?'disabled':''}>+</button>
            </div>`;
        } else {
             controls = `<div class="score-val" style="color:var(--gold); font-size:0.9rem;">AUTO</div>`;
        }
        return `<div class="player-row ${isWin?'winner':''} ${isBye?'bye-row':''}">
                <div><div class="p-name">${p.name} ${isWin ? '<i class="fas fa-trophy fa-trophy-gold"></i>' : ''}</div><div class="p-class">${p.class}</div></div>${controls}</div>`;
    }

    function checkChampion() {
        const t = savedTournaments[activeGameId];
        const finalRound = t.rounds[t.rounds.length - 1];
        if (finalRound && finalRound.matches[0].winner) {
             document.getElementById('champion-modal').style.display = 'block';
        }
    }
</script>
</body>
</html>
