<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkez Cumhuriyet Ä°lkokulu Turnuva</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Ã–NCEKÄ° STÄ°LLER AYNEN KORUNDU (TV MODU Ä°Ã‡Ä°N OPTÄ°MÄ°ZE EDÄ°LMÄ°Å) */
        :root { --primary: #00f2ea; --secondary: #ff0050; --bg-dark: #0b0c15; --card-bg: #151922; --border: #2a2a35; --success: #00ff88; --warning: #ffd700; --danger: #ff4757; --text-main: #e0e6ed; }
        html, body { overflow-x: hidden; scrollbar-width: none; -ms-overflow-style: none; }
        ::-webkit-scrollbar { display: none; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); background-image: radial-gradient(circle at 10% 20%, rgba(0, 242, 234, 0.05) 0%, transparent 40%), radial-gradient(circle at 90% 80%, rgba(255, 0, 80, 0.05) 0%, transparent 40%); color: var(--text-main); min-height: 100vh; padding-bottom: 50px; }
        h1, h2, h3, .font-modern { font-family: 'Exo 2', sans-serif; text-transform: uppercase; letter-spacing: 1px; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; transition: all 0.5s ease; }
        .container.wide-mode { max-width: 100%; padding: 5px 15px; }
        header { text-align: center; padding: 30px 0 20px 0; margin-bottom: 10px; }
        header h1 { font-size: 2rem; font-weight: 700; background: linear-gradient(to right, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px; }
        .announcement-box { background: linear-gradient(90deg, rgba(255, 0, 80, 0.15) 0%, rgba(255, 0, 80, 0.05) 100%); border: 2px solid var(--secondary); border-radius: 12px; padding: 15px; margin: 20px auto; max-width: 800px; display: flex; align-items: center; gap: 15px; box-shadow: 0 0 25px rgba(255, 0, 80, 0.3); animation: borderPulse 2s infinite alternate; position: relative; overflow: hidden; }
        @keyframes borderPulse { 0% { box-shadow: 0 0 15px rgba(255, 0, 80, 0.2); border-color: rgba(255, 0, 80, 0.6); } 100% { box-shadow: 0 0 35px rgba(255, 0, 80, 0.6); border-color: var(--secondary); } }
        .announcement-box::before { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent); transform: skewX(-20deg); animation: shine 3s infinite; }
        @keyframes shine { 0% { left: -100%; } 20% { left: 200%; } 100% { left: 200%; } }
        .ann-icon-wrapper { background: var(--secondary); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 15px var(--secondary); animation: shake 4s infinite; }
        .ann-icon { font-size: 1.2rem; color: #fff; }
        .ann-content { text-align: left; }
        .ann-title { color: var(--secondary); font-family: 'Exo 2'; font-weight: 900; font-size: 0.8rem; margin-bottom: 2px; }
        .ann-text { font-size: 1rem; color: #fff; font-weight: 600; line-height: 1.2; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .game-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; transition: 0.3s; position: relative; display: flex; flex-direction: column; }
        .game-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card-icon-header { height: 90px; background: linear-gradient(135deg, rgba(255,255,255,0.05), transparent); display: flex; align-items: center; justify-content: center; }
        .game-icon { font-size: 2.2rem; color: var(--primary); filter: drop-shadow(0 0 10px rgba(0, 242, 234, 0.5)); transition: 0.3s; }
        .card-body { padding: 15px; text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .game-card h3 { font-size: 1.1rem; color: #fff; margin-bottom: 5px; }
        .game-meta { font-size: 0.8rem; color: #666; margin-bottom: 10px; display: flex; justify-content: center; gap: 10px; }
        .btn-group { display: flex; gap: 10px; }
        .start-btn { flex: 1; padding: 10px; background: rgba(0, 242, 234, 0.1); border: 1px solid var(--primary); color: var(--primary); font-family: 'Exo 2'; font-weight: 600; cursor: pointer; transition: 0.2s; border-radius: 6px; font-size: 0.9rem; }
        .start-btn:hover { background: var(--primary); color: #000; }
        .start-btn.watch-mode { background: rgba(255, 255, 255, 0.05); border-color: #666; color: #aaa; }
        .start-btn.watch-mode:hover { background: rgba(255, 255, 255, 0.1); color: #fff; }
        .resume-btn { background: rgba(0, 255, 136, 0.1); border-color: var(--success); color: var(--success); }
        .resume-btn:hover { background: var(--success); color: #000; }
        .reset-btn { width: 40px; padding: 10px; background: rgba(255, 0, 80, 0.1); border: 1px solid var(--secondary); color: var(--secondary); border-radius: 6px; cursor: pointer; display: none; align-items: center; justify-content: center; }
        .reset-btn:hover { background: var(--secondary); color: #fff; }
        body.admin-mode .reset-btn { display: flex; }
        .admin-toggle { position: fixed; bottom: 10px; right: 10px; background: rgba(255,255,255,0.05); border: none; color: rgba(255,255,255,0.2); padding: 5px; border-radius: 5px; cursor: pointer; font-size: 1.2rem; z-index: 9999; }
        .admin-badge { display: none; position: fixed; bottom: 10px; left: 10px; background: var(--secondary); color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; z-index: 1000; }
        body.admin-mode .admin-badge { display: block; }
        #tournament-view { display: none; animation: zoomIn 0.4s ease; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        .bracket-header { display: flex; justify-content: space-between; align-items: center; background: rgba(21, 25, 34, 0.95); padding: 10px 20px; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border); position: sticky; top: 5px; z-index: 100; box-shadow: 0 5px 25px rgba(0,0,0,0.5); }
        .bracket-header h2 { font-size: 1.5rem; margin: 0; }
        .back-btn { background: var(--secondary); color: #fff; border: none; padding:8px 20px; border-radius:6px; cursor:pointer; font-size: 1rem; font-weight: bold; }
        .rounds-container { display: flex; flex-direction: column; gap: 25px; padding-bottom: 40px; }
        .round-block { background: rgba(255,255,255,0.01); border: 1px solid var(--border); border-radius: 12px; padding: 15px; position: relative; }
        .round-title { text-align: left; color: var(--warning); font-size: 1.2rem; font-weight: 800; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid rgba(255, 215, 0, 0.2); }
        .matches-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
        .match-card { background: rgba(30, 34, 45, 0.7); border: 1px solid #333; border-radius: 10px; padding: 10px; position: relative; box-shadow: 0 3px 10px rgba(0,0,0,0.2); display: flex; flex-direction: column; justify-content: center; }
        .match-card.completed { border: 2px solid var(--success); background: rgba(0, 255, 136, 0.05); }
        .status-badge { position: absolute; top: -8px; right: 10px; font-size: 0.7rem; background: var(--success); color: #000; padding: 2px 8px; border-radius: 8px; font-weight: 800; display: none; }
        .match-card.completed .status-badge { display: block; }
        .player-row { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.04); padding: 8px 12px; margin-bottom: 6px; border-radius: 6px; border-left: 3px solid transparent; min-height: 45px; }
        .player-row.winner { background: linear-gradient(90deg, rgba(0, 255, 136, 0.25), transparent); border: 1px solid var(--success); border-left: 5px solid var(--success); }
        .match-card.completed .player-row:not(.winner) { opacity: 0.3; filter: grayscale(1); }
        .p-name { font-family: 'Exo 2', sans-serif; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px; color: #fff; }
        .p-class { font-size: 1rem; font-weight: 800; color: #ff9f43; margin-left: auto; padding-left: 10px; }
        .score-controls { display: flex; align-items: center; gap: 5px; }
        .score-val { font-family: 'Exo 2'; font-weight: 800; font-size: 1.5rem; width: 30px; text-align: center; color: #fff; }
        .player-row.winner .score-val { color: var(--success); }
        .btn-s { width: 25px; height: 25px; font-size: 1rem; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        body:not(.admin-mode) .btn-s { display: none; }
        .btn-plus { background: var(--primary); color: #000; }
        .btn-minus { background: #333; color: #aaa; }
        .filter-nav { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .f-btn { padding: 6px 15px; background: transparent; border: 1px solid var(--border); color: #888; border-radius: 50px; cursor: pointer; transition: 0.3s; font-size: 0.9rem; }
        .f-btn.active { border-color: var(--primary); color: #fff; background: rgba(0,242,255,0.05); }
        .champion-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .champion-card { background: #1a1a1a; border: 4px solid var(--gold); padding: 40px; border-radius: 30px; text-align: center; box-shadow: 0 0 100px rgba(255, 215, 0, 0.3); animation: popIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .close-champ-btn { margin-top: 20px; padding: 10px 30px; background: var(--gold); color: #000; border: none; font-weight: bold; font-size: 1rem; cursor: pointer; border-radius: 8px; }
        
        /* Loading GÃ¶stergesi */
        #sync-status { position: fixed; top: 10px; right: 10px; color: #888; font-size: 0.8rem; z-index: 99999; }
        .syncing { color: var(--warning) !important; }
        .synced { color: var(--success) !important; }
    </style>
</head>
<body>

<div id="sync-status"><i class="fas fa-circle"></i></div>

<div class="container">
    <header id="main-header">
        <h1>MERKEZ CUMHURÄ°YET Ä°LKOKULU<br>TAZOF TURNUVA EÅLEÅMELERÄ°</h1>
        <div class="announcement-box">
            <div class="ann-icon-wrapper"><i class="fas fa-bullhorn ann-icon"></i></div>
            <div class="ann-content">
                <div class="ann-title">Ã–NEMLÄ° DUYURU</div>
                <div class="ann-text">KarÅŸÄ±laÅŸmalar 5. derste baÅŸlayÄ±p okul bitimine kadar tamamlanacaktÄ±r.</div>
            </div>
        </div>
    </header>

    <div id="games-view">
        <div class="filter-nav">
            <button class="f-btn active" onclick="filterGames('all', this)">TÃ¼mÃ¼</button>
            <button class="f-btn" onclick="filterGames('13.01.2026', this)">13 Ocak</button>
            <button class="f-btn" onclick="filterGames('14.01.2026', this)">14 Ocak</button>
            <button class="f-btn" onclick="filterGames('15.01.2026', this)">15 Ocak</button>
        </div>
        <div class="games-grid" id="games-grid"></div>
    </div>

    <div id="tournament-view"></div>
</div>

<div id="champion-modal" style="display: none;"></div>

<button class="admin-toggle" onclick="toggleAdmin()"><i class="fas fa-lock"></i></button>
<div class="admin-badge">YÃ–NETÄ°CÄ° MODU</div>

<script>
    // --- BURAYA DÄ°KKAT: JSONBIN.IO BÄ°LGÄ°LERÄ°NÄ°ZÄ° GÄ°RÄ°N ---
    // EÄŸer henÃ¼z almadÄ±ysanÄ±z: 
    // 1. jsonbin.io'ya Ã¼ye olun.
    // 2. Create Bin diyip boÅŸ {} parantez kaydedin.
    // 3. Bin ID'yi ve API Key'i aÅŸaÄŸÄ±ya yapÄ±ÅŸtÄ±rÄ±n.
    
    const BIN_ID = "69660ec3d0ea881f40689aaf"; // Ã–rn: 65a12b...
    const API_KEY = "$2a$10$jyaUVJ4i7lf8QTCnEWTlpesulUPPq0rODrO1Yy/ljOVLKy.FVU1M2"; // Ã–rn: $2a$10$...

    const games = [
        { id: 1, name: "Pentago", date: "13.01.2026 SalÄ±", icon: "fa-solid fa-braille" }, 
        { id: 2, name: "Abluka", date: "14.01.2026 Ã‡arÅŸamba", icon: "fa-solid fa-shield-halved" },
        { id: 3, name: "Motif", date: "15.01.2026 PerÅŸembe", icon: "fa-solid fa-shapes" },
        { id: 4, name: "Equlibrio", date: "14.01.2026 Ã‡arÅŸamba", icon: "fa-solid fa-scale-balanced" },
        { id: 5, name: "KÃ¼re", date: "15.01.2026 PerÅŸembe", icon: "fa-solid fa-earth-americas" }
    ];

    const players = [
        { id: 1, name: "YAÄMUR KIZIL", class: "4/F", game_id: 1 }, { id: 2, name: "AHSEN DEMÄ°RBAÅ", class: "2/F", game_id: 1 }, { id: 3, name: "ZEYNEP MÄ°NA KURBAN", class: "2/D", game_id: 1 }, { id: 4, name: "ELÄ°F SU YILDIZAY", class: "3/E", game_id: 1 }, { id: 5, name: "Ã–MER ASAF ERHAN", class: "2/E", game_id: 1 }, { id: 6, name: "DERÄ°N AKBULUT", class: "2/E", game_id: 1 }, { id: 7, name: "ELÄ°F NAZ BÄ°LEN", class: "2/E", game_id: 1 }, { id: 8, name: "SALÄ°H ERDEM YAZAR", class: "2/E", game_id: 1 }, { id: 9, name: "YASEMÄ°N KILBAÅ", class: "2/E", game_id: 1 }, { id: 10, name: "MUHAMMED EMÄ°R KOÃ‡AK", class: "2/E", game_id: 1 }, { id: 11, name: "SÄ°MANUR UÃ‡AR", class: "4/A", game_id: 1 }, { id: 12, name: "NEHÄ°R EROÄLU", class: "4/F", game_id: 1 }, { id: 13, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 1 }, { id: 14, name: "SONGÃœL ESMA AÄBULUT", class: "3/D", game_id: 1 }, { id: 15, name: "EYÃœP ASAF BEKTAÅ", class: "2/B", game_id: 1 }, { id: 16, name: "AHMET BUÄRA DEMÄ°R", class: "2/B", game_id: 1 }, { id: 17, name: "Ã–MER KAÅIKÃ‡I", class: "2/D", game_id: 1 }, { id: 18, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 1 }, { id: 19, name: "MEMDUHA NEHÄ°R KÃ–KSALAN", class: "3/D", game_id: 1 }, { id: 20, name: "HAMZA MUSUL", class: "4/F", game_id: 1 }, { id: 21, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 1 }, { id: 22, name: "HAYRUNNÄ°SA Ã‡EÃ‡EN", class: "2/E", game_id: 1 }, { id: 23, name: "MELÄ°N PEKÄ°N", class: "2/E", game_id: 1 }, { id: 24, name: "ALÄ° TUÄRA DEMÄ°R", class: "2/D", game_id: 1 }, { id: 100, name: "YUSUF CEYLAN", class: "2/E", game_id: 1 },
        { id: 25, name: "SALÄ°H ERDEM YAZAR", class: "2/E", game_id: 2 }, { id: 26, name: "YÄ°ÄÄ°T HAMZA CENGÄ°Z", class: "2/E", game_id: 2 }, { id: 27, name: "Ã–YKÃœ TÄ°RYAKÄ°", class: "4/A", game_id: 2 }, { id: 28, name: "AZRA TOROS", class: "4/A", game_id: 2 }, { id: 29, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 2 }, { id: 30, name: "SONGÃœL ESMA AÄBULUT", class: "3/D", game_id: 2 }, { id: 31, name: "Ã–MER KAÅIKÃ‡I", class: "2/D", game_id: 2 }, { id: 32, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 2 }, { id: 33, name: "MEMDUHA NEHÄ°R KÃ–KSALAN", class: "3/D", game_id: 2 }, { id: 34, name: "HAMZA MUSUL", class: "4/F", game_id: 2 }, { id: 35, name: "POYRAZ LAï¿½ï¿½Ä°NKAYA", class: "4/F", game_id: 2 }, { id: 36, name: "AZÄ°Z MUHARREM ATÄ°LA", class: "3/D", game_id: 2 }, { id: 37, name: "HAYRUNNÄ°SA Ã‡EÃ‡EN", class: "2/E", game_id: 2 }, { id: 38, name: "ÃœMRA SUNA KALELÄ°", class: "4/A", game_id: 2 }, { id: 39, name: "ALÄ° TUÄRA DEMÄ°R", class: "2/D", game_id: 2 }, { id: 99, name: "DEFNE SULUOÄLU", class: "4/A", game_id: 2 },
        { id: 40, name: "ECRÄ°N Ã‡AKIR", class: "4/E", game_id: 3 }, { id: 41, name: "TUÄÃ‡ENUR GÃ–ZE", class: "2/D", game_id: 3 }, { id: 42, name: "YAÄIZ DUMAN", class: "4/F", game_id: 3 }, { id: 43, name: "ENES GÃœZEL", class: "4/D", game_id: 3 }, { id: 44, name: "AHMET EYMEN KOÃ‡", class: "2/A", game_id: 3 }, { id: 45, name: "ALPER Ã‡AKAR", class: "4/F", game_id: 3 }, { id: 46, name: "ALÄ° ASLAN", class: "4/C", game_id: 3 }, { id: 47, name: "AHMET EMRE Ã–ZDEMÄ°R", class: "2/C", game_id: 3 }, { id: 48, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 3 }, { id: 49, name: "SONGÃœL ESMA AÄBULUT", class: "3/D", game_id: 3 }, { id: 50, name: "YÃœSRA NUR GÃœLER", class: "3/D", game_id: 3 }, { id: 51, name: "Ã–MER KAÅIKÃ‡I", class: "2/D", game_id: 3 }, { id: 52, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 3 }, { id: 53, name: "EGEMEN ALTUNDAÄ", class: "3/D", game_id: 3 }, { id: 54, name: "HAMZA MUSUL", class: "4/F", game_id: 3 }, { id: 55, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 3 }, { id: 56, name: "AZÄ°Z MUHARREM ATÄ°LA", class: "3/D", game_id: 3 },
        { id: 57, name: "ECRÄ°N Ã‡AKIR", class: "4/E", game_id: 4 }, { id: 58, name: "YAÄMUR KIZIL", class: "4/F", game_id: 4 }, { id: 59, name: "MUHAMMED EMÄ°R KOÃ‡AK", class: "2/E", game_id: 4 }, { id: 60, name: "ENES GÃœZEL", class: "4/D", game_id: 4 }, { id: 61, name: "AYÅENUR YILMAZ", class: "2/A", game_id: 4 }, { id: 62, name: "AMÄ°NE BAHADIR", class: "4/F", game_id: 4 }, { id: 63, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 4 }, { id: 64, name: "SONGÃœL ESMA AÄBULUT", class: "3/D", game_id: 4 }, { id: 65, name: "YAVUZ SELÄ°M GÃœNEÅ", class: "3/D", game_id: 4 }, { id: 66, name: "MELÄ°SA Ã‡ANKAYA", class: "3/D", game_id: 4 }, { id: 67, name: "Ã–MER KAÅIKÃ‡I", class: "2/D", game_id: 4 }, { id: 68, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 4 }, { id: 69, name: "HAMZA MUSUL", class: "4/F", game_id: 4 }, { id: 70, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 4 }, { id: 71, name: "HAYRUNNÄ°SA Ã‡EÃ‡EN", class: "2/E", game_id: 4 },
        { id: 72, name: "EMÄ°RHAN KODALAK", class: "4/E", game_id: 5 }, { id: 73, name: "YAÄMUR KIZIL", class: "4/F", game_id: 5 }, { id: 74, name: "AZRA TOROS", class: "4/A", game_id: 5 }, { id: 75, name: "ALÄ° AYAZ KAZAN", class: "3/B", game_id: 5 }, { id: 76, name: "SONGÃœL ESMA AÄBULUT", class: "3/D", game_id: 5 }, { id: 77, name: "Ã–MER KAÅIKÃ‡I", class: "2/D", game_id: 5 }, { id: 78, name: "Ã–ZNUR DUMAN", class: "3/D", game_id: 5 }, { id: 79, name: "MEMDUHA NEHÄ°R KÃ–KSALAN", class: "3/D", game_id: 5 }, { id: 80, name: "HAMZA MUSUL", class: "4/F", game_id: 5 }, { id: 81, name: "POYRAZ LAÃ‡Ä°NKAYA", class: "4/F", game_id: 5 }, { id: 82, name: "ZEYNEP KUZEY", class: "4/A", game_id: 5 }, { id: 83, name: "AZÄ°Z MUHARREM ATÄ°LA", class: "3/D", game_id: 5 }, { id: 84, name: "ALÄ° TUÄRA DEMÄ°R", class: "2/D", game_id: 5 }
    ];

    let savedTournaments = {}; 
    let activeGameId = null;

    // --- CLOUD STORAGE FONKSÄ°YONLARI ---
    async function loadFromStorage() {
        if(BIN_ID === "69660ec3d0ea881f40689aaf") {
            const saved = localStorage.getItem('merkezTurnuvaDataV20'); 
            if(saved) savedTournaments = JSON.parse(saved);
            return;
        }

        updateSyncStatus("YÃ¼kleniyor...", "syncing");
        try {
            const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                headers: { 'X-Master-Key': API_KEY }
            });
            if(response.ok) {
                const data = await response.json();
                savedTournaments = data.record;
                updateSyncStatus("Senkronize", "synced");
                renderGames('all'); // Veri gelince ekranÄ± yenile
                if(activeGameId) renderBracket(); // EÄŸer turnuva aÃ§Ä±ksa orayÄ± da yenile
            }
        } catch (e) {
            console.error("Veri Ã§ekme hatasÄ±", e);
            updateSyncStatus("Hata!", "error");
        }
    }
    
    async function saveToStorage() {
        if(BIN_ID === "69660ec3d0ea881f40689aaf") {
            localStorage.setItem('merkezTurnuvaDataV20', JSON.stringify(savedTournaments));
            return;
        }

        updateSyncStatus("Kaydediliyor...", "syncing");
        try {
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': API_KEY
                },
                body: JSON.stringify(savedTournaments)
            });
            updateSyncStatus("Kaydedildi", "synced");
        } catch (e) {
            console.error("Kaydetme hatasÄ±", e);
            updateSyncStatus("Hata!", "error");
        }
    }

    function updateSyncStatus(text, statusClass) {
        const el = document.getElementById('sync-status');
        el.innerHTML = `<i class="fas fa-circle"></i> ${text}`;
        el.className = statusClass;
    }

    // Her 10 saniyede bir verileri yenile (CanlÄ± izleme iÃ§in)
    setInterval(() => {
        if(!document.body.classList.contains('admin-mode')) {
            loadFromStorage();
        }
    }, 10000);

    function toggleAdmin() {
        const pass = prompt("YÃ¶netici Åifresi:");
        if (pass === "3525853256") {
            document.body.classList.toggle('admin-mode');
            alert(document.body.classList.contains('admin-mode') ? "YÃ¶netici Modu AÃ‡IK" : "Ä°zleme Moduna GeÃ§ildi");
            const activeFilter = document.querySelector('.f-btn.active');
            renderGames(activeFilter ? activeFilter.innerText.split(' ')[0].toLowerCase().replace('tÃ¼mÃ¼','all') : 'all');
        } else if(pass !== null) {
            alert("HatalÄ± Åifre!");
        }
    }

    window.onload = () => {
        loadFromStorage();
        renderGames('all');
    };

    function filterGames(filter, btn) {
        document.querySelectorAll('.f-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderGames(filter);
    }

    function renderGames(filter) {
        const grid = document.getElementById('games-grid');
        grid.innerHTML = '';
        const list = filter === 'all' ? games : games.filter(g => g.date.includes(filter));
        const isAdmin = document.body.classList.contains('admin-mode');
        
        list.forEach(g => {
            const count = players.filter(p => p.game_id === g.id).length;
            const isStarted = savedTournaments[g.id] !== undefined;
            
            let btnText = "TURNUVAYI Ä°ZLE";
            let btnClass = "start-btn watch-mode";
            
            if (isStarted) {
                btnText = "SONUÃ‡LARI GÃ–R";
                btnClass = "start-btn resume-btn";
            } else if (isAdmin) {
                btnText = "TURNUVAYI BAÅLAT";
                btnClass = "start-btn";
            }
            
            let resetButton = '';
            if (isStarted) {
                resetButton = `<button class="reset-btn" onclick="resetTournament(${g.id}, event)" title="SÄ±fÄ±rla"><i class="fas fa-sync-alt"></i></button>`;
            }

            grid.innerHTML += `
                <div class="game-card">
                    <div class="card-icon-header"><i class="${g.icon} game-icon"></i></div>
                    <div class="card-body">
                        <h3 class="font-modern">${g.name}</h3>
                        <div class="game-meta">
                            <span><i class="fas fa-calendar"></i> ${g.date.split(' ')[0]}</span>
                            <span><i class="fas fa-users"></i> ${count}</span>
                        </div>
                        <div class="btn-group">
                            <button class="${btnClass}" onclick="handleGameClick(${g.id})">${btnText}</button>
                            ${resetButton}
                        </div>
                    </div>
                </div>`;
        });
    }

    function handleGameClick(gameId) {
        activeGameId = gameId;
        const isAdmin = document.body.classList.contains('admin-mode');
        if (!savedTournaments[gameId]) {
            if(!isAdmin) { alert("Turnuva henÃ¼z baÅŸlamadÄ±."); return; }
            initTournament(gameId);
        }
        showTournamentView();
    }
    
    function resetTournament(gameId, event) {
        event.stopPropagation();
        if(!document.body.classList.contains('admin-mode')) {
             alert("Bu iÅŸlem iÃ§in yÃ¶netici giriÅŸi yapmalÄ±sÄ±nÄ±z!");
             return;
        }
        const pass = prompt("SÄ±fÄ±rlama OnayÄ± iÃ§in Åifre:");
        if(pass !== "04051257") { alert("HatalÄ± Åifre!"); return; }

        if(confirm("TÃ¼m veriler silinecek ve kura yeniden Ã§ekilecek. OnaylÄ±yor musunuz?")) {
            delete savedTournaments[gameId];
            saveToStorage();
            initTournament(gameId);
            showTournamentView();
        }
    }

    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }
    function genID() { return Math.random().toString(36).substr(2, 9); } 

    function initTournament(gameId) {
        const game = games.find(g => g.id === gameId);
        let participants = shuffle(players.filter(p => p.game_id === gameId));
        
        const N = participants.length;
        let rounds = [];
        let power = 1;
        while (power * 2 <= N) power *= 2;
        
        if (N === power) {
             let m = [];
             for(let i=0; i<N; i+=2) m.push({ id: genID(), p1: participants[i], p2: participants[i+1], s1:0, s2:0, winner:null });
             rounds.push({ name: "1. TUR", matches: m });
        } else {
             const playInCount = (N - power) * 2; 
             let playInMatches = [];
             
             for(let i=0; i<playInCount; i+=2) {
                 playInMatches.push({ 
                     id: genID(),
                     p1: participants[i], 
                     p2: participants[i+1], 
                     s1:0, s2:0, winner:null,
                     nextRoundMatchIndex: -1, 
                     nextSlot: -1 
                 });
             }
             rounds.push({ name: "Ã–N ELEME", matches: playInMatches });
             
             let mainMatches = [];
             let directPlayers = participants.slice(playInCount);
             let dpIdx = 0;
             let piIdx = 0; 
             
             for(let i=0; i < power/2; i++) {
                 let p1 = null, p2 = null;
                 if (dpIdx < directPlayers.length) p1 = directPlayers[dpIdx++];
                 else { if(piIdx < playInMatches.length) { playInMatches[piIdx].nextRoundMatchIndex = i; playInMatches[piIdx].nextSlot = 1; piIdx++; } }
                 
                 if (dpIdx < directPlayers.length) p2 = directPlayers[dpIdx++];
                 else { if(piIdx < playInMatches.length) { playInMatches[piIdx].nextRoundMatchIndex = i; playInMatches[piIdx].nextSlot = 2; piIdx++; } }
                 
                 mainMatches.push({ id: genID(), p1: p1, p2: p2, s1:0, s2:0, winner:null });
             }
             rounds.push({ name: "1. TUR", matches: mainMatches });
        }
        
        let lastRound = rounds[rounds.length-1];
        let matchCount = lastRound.matches.length;
        let rCounter = 2;
        
        while(matchCount > 1) {
            matchCount /= 2;
            let m = Array(matchCount).fill(null).map(() => ({ id: genID(), p1:null, p2:null, s1:0, s2:0, winner:null }));
            rounds.push({ name: `TUR ${rCounter}`, matches: m });
            rCounter++;
        }
        
        rounds.forEach((r, i) => {
            if (i === rounds.length - 1) r.name = "ğŸ† FÄ°NAL";
            else if (i === rounds.length - 2) r.name = "ğŸ”¥ YARI FÄ°NAL";
            else if (i === rounds.length - 3) r.name = "âš”ï¸ Ã‡EYREK FÄ°NAL";
        });

        savedTournaments[gameId] = { game, rounds, totalRounds: rounds.length };
        saveToStorage();
    }

    function updateScore(matchId, pNum, change) {
        if (!document.body.classList.contains('admin-mode')) return;

        const t = savedTournaments[activeGameId];
        let match = null;
        let rIdx = -1;
        let mIdx = -1;

        for(let r=0; r<t.rounds.length; r++) {
            for(let m=0; m<t.rounds[r].matches.length; m++) {
                if(t.rounds[r].matches[m].id === matchId) {
                    match = t.rounds[r].matches[m];
                    rIdx = r;
                    mIdx = m;
                    break;
                }
            }
            if(match) break;
        }

        if (!match) return; 
        
        if (match.winner && change > 0) return; 
        
        if (pNum === 1) match.s1 = Math.max(0, Math.min(2, match.s1 + change));
        else match.s2 = Math.max(0, Math.min(2, match.s2 + change));

        let newWinner = null;
        if (match.s1 === 2) newWinner = match.p1;
        else if (match.s2 === 2) newWinner = match.p2;

        if (match.winner !== newWinner) {
            match.winner = newWinner;
            if (t.rounds[rIdx].name === "Ã–N ELEME") advancePlayInWinner(activeGameId, mIdx, newWinner);
            else advanceWinner(activeGameId, rIdx, mIdx, newWinner);
        }
        saveToStorage();
        renderBracket();
        checkChampion();
    }

    function advancePlayInWinner(gId, mIdx, winner) {
        const t = savedTournaments[gId];
        const currentMatch = t.rounds[0].matches[mIdx];
        const targetRIdx = 1;
        const targetMIdx = currentMatch.nextRoundMatchIndex;
        const targetSlot = currentMatch.nextSlot;
        
        if (targetMIdx !== undefined && targetMIdx !== -1) {
            const targetMatch = t.rounds[targetRIdx].matches[targetMIdx];
            if (targetSlot === 1) targetMatch.p1 = winner;
            else targetMatch.p2 = winner;
            if (!winner) { 
                targetMatch.s1 = 0; targetMatch.s2 = 0; targetMatch.winner = null; 
                advanceWinner(gId, targetRIdx, targetMIdx, null); 
            }
        }
    }

    function advanceWinner(gId, rIdx, mIdx, winner) {
        const t = savedTournaments[gId];
        const nextRIdx = rIdx + 1;
        if (nextRIdx < t.totalRounds) {
            const nextMIdx = Math.floor(mIdx / 2);
            const isTopSlot = (mIdx % 2 === 0);
            const nextMatch = t.rounds[nextRIdx].matches[nextMIdx];
            if (isTopSlot) nextMatch.p1 = winner; else nextMatch.p2 = winner;
            if (!winner) { 
                nextMatch.s1 = 0; nextMatch.s2 = 0; nextMatch.winner = null; 
                advanceWinner(gId, nextRIdx, nextMIdx, null); 
            }
        }
    }

    function showTournamentView() {
        document.querySelector('.container').classList.add('wide-mode'); 
        document.getElementById('games-view').style.display = 'none';
        document.getElementById('tournament-view').style.display = 'block';
        renderBracket();
    }

    function closeTournamentView() {
        document.querySelector('.container').classList.remove('wide-mode'); 
        document.getElementById('tournament-view').style.display = 'none';
        document.getElementById('games-view').style.display = 'block';
        const activeFilter = document.querySelector('.f-btn.active');
        renderGames(activeFilter ? activeFilter.innerText.split(' ')[0].toLowerCase().replace('tÃ¼mÃ¼','all') : 'all');
    }

    function renderBracket() {
        const t = savedTournaments[activeGameId];
        const container = document.getElementById('tournament-view');
        let html = `
            <div class="bracket-header">
                <div>
                    <h2 class="font-modern" style="color:var(--primary)">${t.game.name}</h2>
                    <span style="color:#888; font-size:0.9rem">${t.game.date}</span>
                </div>
                <button class="back-btn" onclick="closeTournamentView()">Ã‡IK</button>
            </div>
            <div class="rounds-container">
        `;

        t.rounds.forEach((r, rIdx) => {
            html += `<div class="round-block">
                        <div class="round-title"><i class="fas fa-layer-group"></i> ${r.name}</div>
                        <div class="matches-grid">`;
            r.matches.forEach((m, mIdx) => {
                const isCompleted = m.winner !== null;
                const isBye = m.isBye;
                html += `<div class="match-card ${isCompleted?'completed':''} ${isBye?'bye-match':''}">`;
                if(isCompleted) html += `<div class="status-badge">TAMAMLANDI</div>`;
                html += renderPlayer(m.p1, m.s1, m.winner, m.id, 1, isBye);
                
                if (isBye) html += `<div class="bye-label"><i class="fas fa-forward"></i> BAY GEÃ‡TÄ°</div>`;
                else if (m.waitingForPlayIn && !m.p2) html += `<div style="text-align:center; font-size:0.9rem; color:#444; margin:8px 0;">Ã–N ELEMEDEN GELECEK</div>`;
                else html += `<div style="text-align:center; font-size:0.8rem; color:#444; margin:8px 0;">VS</div>`;
                
                if (!isBye) html += renderPlayer(m.p2, m.s2, m.winner, m.id, 2, false);
                html += `</div>`;
            });
            html += `</div></div>`;
        });
        
        const finalRound = t.rounds[t.rounds.length - 1];
        if(finalRound && finalRound.matches[0].winner) {
            const champ = finalRound.matches[0].winner;
            const modal = document.getElementById('champion-modal');
            modal.innerHTML = `
                <div class="champion-overlay">
                    <div class="champion-card">
                        <i class="fas fa-crown champ-icon" style="font-size:3rem; color:var(--gold); margin-bottom:20px;"></i>
                        <h2 style="color:var(--gold); font-family:'Exo 2'; font-size:3rem; margin-bottom:10px">KAZANAN</h2>
                        <div class="champ-name" style="font-size:2.5rem; font-weight:bold; color:#fff">${champ.name}</div>
                        <div style="color:#888; font-size:1.5rem">${champ.class}</div>
                        <button class="close-champ-btn" onclick="document.getElementById('champion-modal').style.display='none'">KAPAT</button>
                    </div>
                </div>`;
            modal.style.display = 'flex';
        }
        
        container.innerHTML = html + '</div>';
    }

    function renderPlayer(p, s, winner, matchId, pNum, isBye) {
        if (!p) return `<div class="player-row" style="opacity:0.5; border:1px dashed #333"><div class="score-val"></div><div class="p-name" style="font-size:1rem">Bekleniyor...</div></div>`;
        const isWin = winner && winner.id === p.id;
        const disablePlus = s >= 2;
        let controls = '';
        if(!isBye) {
             controls = `<div class="score-controls">
                <button class="btn-s btn-minus" onclick="updateScore('${matchId}', ${pNum}, -1)" ${s<=0?'disabled':''}>-</button>
                <div class="score-val">${s}</div>
                <button class="btn-s btn-plus" onclick="updateScore('${matchId}', ${pNum}, 1)" ${disablePlus?'disabled':''}>+</button>
            </div>`;
        } else {
             controls = `<div class="score-val" style="color:var(--gold); font-size:0.9rem;">AUTO</div>`;
        }
        return `<div class="player-row ${isWin?'winner':''} ${isBye?'bye-row':''}">
                <div><div class="p-name">${p.name} ${isWin ? '<i class="fas fa-trophy fa-trophy-gold"></i>' : ''}</div><div class="p-class">${p.class}</div></div>${controls}</div>`;
    }

    function checkChampion() {
        const t = savedTournaments[activeGameId];
        const finalRound = t.rounds[t.rounds.length - 1];
        if (finalRound && finalRound.matches[0].winner) {
             document.getElementById('champion-modal').style.display = 'block';
        }
    }
</script>
</body>
</html>
